# –ü–ª–∞–Ω —Ä–∞–±–æ—Ç ‚Äî Advanced Sound Engine

–°–æ–∑–¥–∞–Ω: –§–µ–≤—Ä–∞–ª—å 2026
–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∞–≥–æ–≤: `bugs-analysis.md`
–ò—Å—Ç–æ—á–Ω–∏–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: `.agent/rules/project-memory.md` (Single Source of Truth)

---

## –í–∞–∂–Ω—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ project-memory.md

1. **project-memory.md:103** —É–∫–∞–∑—ã–≤–∞–µ—Ç `Howler.js (underlying audio)`, –Ω–æ —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `HTMLAudioElement` + `MediaElementAudioSourceNode` (Web Audio API) –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `StreamingPlayer.ts`. Howler.js **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**. –≠—Ç–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
2. **project-memory.md:96-97** ‚Äî `stopAll broadcast exists but not called by AudioEngine.stopAll()` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∞–Ω–∞–ª–∏–∑–æ–º –∫–æ–¥–∞. Broadcast –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ UI-—Å–ª–æ—è (`AdvancedSoundEngineApp.onGlobalStop()`).
3. **project-memory.md:77** ‚Äî `Can enter infinite re-sync loop` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ. –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞: `stopAll()` –æ—á–∏—â–∞–µ—Ç `lastSyncState`, –Ω–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç –ø–ª–µ–µ—Ä—ã –∏–∑ Map.

---

## –§–∞–∑–∞ 1: –§–∞–Ω—Ç–æ–º–Ω—ã–π –∑–≤—É–∫ (–ö–†–ò–¢–ò–ß–ù–û ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç MVP)

**–¶–µ–ª—å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ —É –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä–∞—Ç—å –∑–≤—É–∫ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –î–ú –≤—Å—ë –æ—Å—Ç–∞–Ω–æ–≤–∏–ª.

**–ü—Ä–∏—á–∏–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (–≤—Å–µ –∑–≤–µ–Ω—å—è –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å):**
```
stopAll() –Ω–µ –æ—á–∏—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç Scheduler
  ‚Üí race condition ended event ‚Üí Scheduler —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–æ–≤—ã–π —Ç—Ä–µ–∫
    ‚Üí play()/stop() race –≤ StreamingPlayer ‚Üí state = 'playing' –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º
      ‚Üí verifySyncState() –≤–∏–¥–∏—Ç mismatch ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç resync
        ‚Üí syncState() –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç—Ä–µ–∫ ‚Üí —Ñ–∞–Ω—Ç–æ–º–Ω—ã–π –∑–≤—É–∫
```

### –ó–∞–¥–∞—á–∞ 1.1: –ê—Ç–æ–º–∞—Ä–Ω—ã–π stopAll()
**–§–∞–π–ª—ã:** `src/core/AudioEngine.ts`, `src/core/PlaybackScheduler.ts`, `src/sync/SocketManager.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. `AudioEngine.stopAll()` –¥–æ–ª–∂–µ–Ω:
   - –û—á–∏—â–∞—Ç—å `_activeContext` –≤ PlaybackScheduler (–¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `scheduler.clearContext()`)
   - –í—ã–∑—ã–≤–∞—Ç—å `scheduleSave()` –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
   - –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å socket broadcast (–Ω–µ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ UI-—Å–ª–æ–π)
2. `SocketManager.broadcastStopAll()` ‚Äî —É–±—Ä–∞—Ç—å guard –ø–æ `syncEnabled`. Stop-all –í–°–ï–ì–î–ê –¥–æ–ª–∂–µ–Ω –¥–æ—Ö–æ–¥–∏—Ç—å –¥–æ –∏–≥—Ä–æ–∫–æ–≤, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±—â–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞
3. `PlaybackScheduler` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `_stopped` –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–π –≤ `handleTrackEnded()` –¥–æ –ª—é–±–æ–π –ª–æ–≥–∏–∫–∏

### –ó–∞–¥–∞—á–∞ 1.2: Race condition play()/stop() –≤ StreamingPlayer
**–§–∞–π–ª:** `src/core/StreamingPlayer.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ñ–ª–∞–≥ `_stopRequested = false`
2. –í `stop()`: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `_stopRequested = true` –î–û `audio.pause()`
3. –í `play()`: –ø–æ—Å–ª–µ `await audio.play()` –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `if (this._stopRequested) return` –ø–µ—Ä–µ–¥ `_state = 'playing'`
4. –í `play()`: —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å `_stopRequested = false` –í –ù–ê–ß–ê–õ–ï –º–µ—Ç–æ–¥–∞

### –ó–∞–¥–∞—á–∞ 1.3: –ò—Å–ø—Ä–∞–≤–∏—Ç—å periodic sync verification
**–§–∞–π–ª:** `src/core/PlayerAudioEngine.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –í `stopAll()`: –ø–æ—Å–ª–µ `player.stop()` –≤—ã–∑—ã–≤–∞—Ç—å `player.dispose()` –∏ —É–¥–∞–ª—è—Ç—å –∏–∑ `this.players` Map ‚Äî –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
2. –í `verifySyncState()`: –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ `players.size > 0`, –∞ –Ω–∞–ª–∏—á–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞ —Å `state !== 'stopped'`
3. –î–æ–±–∞–≤–∏—Ç—å guard: –µ—Å–ª–∏ `lastSyncState` –ø—É—Å—Ç –ò –≤—Å–µ –ø–ª–µ–µ—Ä—ã stopped/—É–¥–∞–ª–µ–Ω—ã ‚Üí –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å resync
4. –ï—Å–ª–∏ GM –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ sync-request 3 —Ä–∞–∑–∞ –ø–æ–¥—Ä—è–¥ ‚Üí –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏, –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å warning —á–µ—Ä–µ–∑ Logger.warn()

### –ó–∞–¥–∞—á–∞ 1.4: syncState() –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∏–≥—Ä–∞—é—â–∏–µ —Ç—Ä–µ–∫–∏
**–§–∞–π–ª:** `src/core/PlayerAudioEngine.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –ü–µ—Ä–µ–¥ `player.play(adjustedTime)`:
   - –ï—Å–ª–∏ –ø–ª–µ–µ—Ä —É–∂–µ `playing` –ò `Math.abs(player.getCurrentTime() - adjustedTime) < 1.0` ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å play()
   - –≠—Ç–æ –∏–∑–±–µ–∂–∏—Ç –∞—É–¥–∏–æ-glitch –∏ –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

---

## –§–∞–∑–∞ 2: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–°–≤—è–∑–∞–Ω–æ —Å: `SocketManager` (project-memory.md ¬ß4), message types (¬ß4 sync-start/stop/state, track-play/pause/stop)

### –ó–∞–¥–∞—á–∞ 2.1: Cleanup —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
**–§–∞–π–ª—ã:** `src/ui/AdvancedSoundEngineApp.ts`, `src/ui/SoundMixerApp.ts`, `src/main.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. `AdvancedSoundEngineApp._onClose()` ‚Üí –≤—ã–∑–≤–∞—Ç—å `this.mixerApp.stopUpdates()`
2. `SoundMixerApp` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `stopUpdates()`: clearInterval –¥–ª—è 100ms update loop + –æ—á–∏—Å—Ç–∏—Ç—å throttle timers
3. `main.ts` hook `closeGame` ‚Üí dispose `playbackScheduler` –∏ `queueManager` (project-memory.md ¬ß5)
4. `StreamingPlayer.dispose()` ‚Üí `removeEventListener` –¥–ª—è 'ended', 'canplay', 'error'

### –ó–∞–¥–∞—á–∞ 2.2: Rate limiting –Ω–∞ socket broadcasts
**–§–∞–π–ª:** `src/sync/SocketManager.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –î–ª—è volume/seek/effect-param ‚Äî throttle 100ms (–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
2. –î–ª—è play/stop/pause ‚Äî –±–µ–∑ throttle (—ç—Ç–æ –∫–æ–º–∞–Ω–¥—ã)
3. –î–ª—è fullState sync ‚Äî debounce 250ms
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `debounce()` –∏–∑ `src/utils/throttle.ts` (project-memory.md ¬ß2)

### –ó–∞–¥–∞—á–∞ 2.3: –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ socket-—Å–æ–æ–±—â–µ–Ω–∏–π
**–§–∞–π–ª:** `src/sync/SocketManager.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –î–æ–±–∞–≤–∏—Ç—å `sequenceNumber: number` –≤ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ GM)
2. –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∏–≥—Ä–æ–∫–∞: –æ—Ç–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å `seq < lastProcessedSeq`
3. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç race condition: stop-all (seq:5) ‚Üí track-play (seq:4) = track-play –æ—Ç–±—Ä–æ—à–µ–Ω

### –ó–∞–¥–∞—á–∞ 2.4: –ò—Å–ø—Ä–∞–≤–∏—Ç—å startTimestamp reset –ø—Ä–∏ sync
**–§–∞–π–ª:** `src/sync/SocketManager.ts` ‚Üí `getCurrentSyncState()`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π `startTimestamp` –∏–∑ StreamingPlayer (—Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ play())
2. –î–æ–±–∞–≤–∏—Ç—å `getStartTimestamp()` –≤ StreamingPlayer
3. –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∏–≥—Ä–æ–∫–∞ ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å offset —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ timestamp

---

## –§–∞–∑–∞ 3: –ú–æ–¥—É–ª—å –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª—ë–Ω–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

–°–≤—è–∑–∞–Ω–æ —Å: `main.ts` hooks init/ready (project-memory.md ¬ß6), window.ASE (project-memory.md ¬ß6)

### –ó–∞–¥–∞—á–∞ 3.1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
**–§–∞–π–ª:** `src/main.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Logger (project-memory.md ¬ß2) –≤ –∫–∞–∂–¥—ã–π —Ö—É–∫:
   - `init`: `game.modules.get('advanced-sound-engine')?.active`
   - `ready`: `game.user?.isGM`, socket connection status
   - `getSceneControlButtons` / `renderSceneControls`: –≤—ã–∑–≤–∞–Ω—ã –ª–∏ –≤–æ–æ–±—â–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–æ–∂–µ—Ç –ª–∏ `ready` —Ö—É–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –î–û –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ socket –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (latency > 0)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `game.user?.isGM` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π, –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –ø—Ä–∏ —É–¥–∞–ª—ë–Ω–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
4. –°–æ–±—Ä–∞—Ç—å –ª–æ–≥–∏ —Å —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å

### –ó–∞–¥–∞—á–∞ 3.2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ 3.1 –Ω–µ —Ä–µ—à–∏—Ç)
**–ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:**
- Foundry VTT socket (`game.socket`) –í–°–ï–ì–î–ê —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä, –¥–∞–∂–µ –ª–æ–∫–∞–ª—å–Ω–æ
- –ú–æ–¥–µ–ª—å –ù–ï –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞ "–î–ú ‚Üí –°–µ—Ä–≤–µ—Ä ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" ‚Äî Foundry —É–∂–µ —Ç–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–±–ª–µ–º–∞ —Å–∫–æ—Ä–µ–µ –≤ race condition –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –≤ —Ç–æ–º, —á—Ç–æ –º–æ–¥—É–ª—å –æ–∂–∏–¥–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π AudioEngine –∫–æ–≥–¥–∞ GM –ø–æ–¥–∫–ª—é—á—ë–Ω —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –∫ —É–¥–∞–ª—ë–Ω–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É

---

## –§–∞–∑–∞ 4: –õ–∏–º–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

–°–≤—è–∑–∞–Ω–æ —Å: AudioEngine (project-memory.md ¬ß4), maxSimultaneousTracks setting (¬ß6)

### –ó–∞–¥–∞—á–∞ 4.1: –ù–∞–¥—ë–∂–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
**–§–∞–π–ª:** `src/core/AudioEngine.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –°—á–∏—Ç–∞—Ç—å –ø–æ `createTrack()` –≤—ã–∑–æ–≤–∞–º, –∞ –Ω–µ –ø–æ `state === 'playing'` (state —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è async)
2. –î–æ–±–∞–≤–∏—Ç—å `_pendingPlayCount` —Å—á—ë—Ç—á–∏–∫: +1 –ø—Ä–∏ playTrack(), -1 –ø—Ä–∏ resolve/reject play()
3. –ü—Ä–æ–≤–µ—Ä–∫–∞: `playing + _pendingPlayCount >= max` ‚Üí –æ—Ç–∫–∞–∑
4. –¢–µ–∫—É—â–∏–π –ª–∏–º–∏—Ç 8 —Ç—Ä–µ–∫–æ–≤ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å, —ç—Ç–æ —Ä–∞–∑—É–º–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞

### –ó–∞–¥–∞—á–∞ 4.2: –ü—Ä–∏–º–µ–Ω—è—Ç—å –ª–∏–º–∏—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∏–≥—Ä–æ–∫–∞
**–§–∞–π–ª:** `src/core/PlayerAudioEngine.ts`
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –í `handlePlay()` –∏ `syncState()` ‚Äî –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–ª–µ–µ—Ä–æ–≤
2. –ï—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω ‚Üí –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π —Ç—Ä–µ–∫

---

## –§–∞–∑–∞ 5: –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ (–ø–æ –º–µ—Ä–µ —Å–∏–ª, –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏)

### –ó–∞–¥–∞—á–∞ 5.1: –£–±—Ä–∞—Ç—å console.log DEBUG
**–§–∞–π–ª—ã:** –í—Å–µ `src/ui/*.ts`, `src/core/*.ts`
- –ó–∞–º–µ–Ω–∏—Ç—å `console.log('[ASE DEBUG]...')` –Ω–∞ `Logger.debug()` (project-memory.md ¬ß2)

### –ó–∞–¥–∞—á–∞ 5.2: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥–≤–æ–π–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä
**–§–∞–π–ª—ã:** `src/ui/AdvancedSoundEngineApp.ts`, `src/ui/SoundMixerApp.ts`
- –î–≤–æ–π–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `queueManager.on('change')` ‚Üí —É–±—Ä–∞—Ç—å –æ–¥–Ω—É
- –£—á–∏—Ç—ã–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ project-memory.md ¬ß3 (Render Delegation, queue listener debounce 50ms)

### –ó–∞–¥–∞—á–∞ 5.3: Volume broadcasts –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å syncEnabled
**–§–∞–π–ª:** `src/ui/AdvancedSoundEngineApp.ts`
- –û–±–µ—Ä–Ω—É—Ç—å channel/master volume broadcasts –≤ `if (this.socket.syncEnabled)`

### –ó–∞–¥–∞—á–∞ 5.4: –£–±—Ä–∞—Ç—å `any`
**–§–∞–π–ª—ã:** –ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º grep –Ω–∞ `any`
- –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã –∏–ª–∏ `unknown` + type guards
- –û—Å–æ–±–µ–Ω–Ω–æ: `parentApp: any`, `(controls as any).sounds`

### –ó–∞–¥–∞—á–∞ 5.5: –û–±–Ω–æ–≤–∏—Ç—å project-memory.md
**–§–∞–π–ª:** `.agent/rules/project-memory.md`
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å ¬ß5: `Howler.js (underlying audio)` ‚Üí `HTMLAudioElement + Web Audio API (StreamingPlayer.ts)`
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ PlaybackScheduler –≤ ¬ß4 (–µ–≥–æ –Ω–µ—Ç –≤ project-memory)
- –û–±–Ω–æ–≤–∏—Ç—å Known Issues –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
–§–∞–∑–∞ 1 (–§–∞–Ω—Ç–æ–º–Ω—ã–π –∑–≤—É–∫)     ‚Üí –ü–ï–†–í–´–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–±–ª–æ–∫–∏—Ä—É–µ—Ç MVP)
  1.1 ‚Üí 1.2 ‚Üí 1.3 ‚Üí 1.4      (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∫–∞–∂–¥—ã–π fix —Ç–µ—Å—Ç–∏—Ä—É–µ–º)

–§–∞–∑–∞ 2 (–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å sync)  ‚Üí –í–¢–û–†–û–ô –ü–†–ò–û–†–ò–¢–ï–¢
  2.1 ‚Üí 2.2 ‚Üí 2.3 ‚Üí 2.4      (–æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ —Å–ª–æ–∂–Ω–æ–º—É)

–§–∞–∑–∞ 3 (–£–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)   ‚Üí –¢–†–ï–¢–ò–ô (–Ω—É–∂–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ)
  3.1 ‚Üí –ø–æ—Ç–æ–º —Ä–µ—à–∞–µ–º 3.2

–§–∞–∑–∞ 4 (–õ–∏–º–∏—Ç —Ç—Ä–µ–∫–æ–≤)       ‚Üí –ß–ï–¢–í–Å–†–¢–´–ô (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ 8 —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
  4.1 ‚Üí 4.2

–§–∞–∑–∞ 5 (–ö–∞—á–µ—Å—Ç–≤–æ)           ‚Üí –ü–Ø–¢–´–ô (–ø–æ –º–µ—Ä–µ —Å–∏–ª, –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏)
  5.1 ‚Üí 5.2 ‚Üí 5.3 ‚Üí 5.4 ‚Üí 5.5
```

---

## –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|------|-------------|
| 1.1 | ‚úÖ DONE | Feb 2026 | –ê—Ç–æ–º–∞—Ä–Ω—ã–π stopAll |
| 1.2 | ‚úÖ DONE | Feb 2026 | Race condition StreamingPlayer |
| 1.3 | ‚úÖ DONE | Feb 2026 | Periodic sync verification |
| 1.4 | ‚úÖ DONE | Feb 2026 | syncState() re-play guard |
| 2.1 | ‚úÖ DONE | Feb 2026 | Cleanup: _onClose(), dispose() –¥–ª—è SoundMixerApp/PlaybackScheduler/QueueManager |
| 2.2 | ‚úÖ DONE | Feb 2026 | throttledSend(150ms) –¥–ª—è seek/volume/channelVol/effectParam |
| 2.3 | ‚úÖ DONE | Feb 2026 | PROTOCOL_VERSION –≤ SocketMessage + mismatch warnings |
| 2.4 | ‚úÖ DONE | Feb 2026 | startTimestamp snapshot pattern verified correct, console.log‚ÜíLogger cleanup |
| 3.1 | ‚¨ú TODO | ‚Äî | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ |
| 3.2 | ‚¨ú TODO | ‚Äî | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è |
| 4.1 | ‚¨ú TODO | ‚Äî | –ü–æ–¥—Å—á—ë—Ç —Ç—Ä–µ–∫–æ–≤ |
| 4.2 | ‚¨ú TODO | ‚Äî | –õ–∏–º–∏—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∏–≥—Ä–æ–∫–∞ |
| 5.1 | üîÑ PARTIAL | Feb 2026 | SocketManager, PlayerAudioEngine, SoundEffectsApp cleaned (–æ—Å—Ç–∞—ë—Ç—Å—è AdvancedSoundEngineApp) |
| 5.2 | ‚¨ú TODO | ‚Äî | –î–≤–æ–π–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä |
| 5.3 | ‚¨ú TODO | ‚Äî | Volume sync guard |
| 5.4 | ‚¨ú TODO | ‚Äî | –£–±—Ä–∞—Ç—å any |
| 5.5 | ‚¨ú TODO | ‚Äî | –û–±–Ω–æ–≤–∏—Ç—å project-memory.md |
