{"version":3,"file":"module.js","sources":["../src/utils/logger.ts","../src/core/StreamingPlayer.ts","../src/utils/time.ts","../src/core/AudioEngine.ts","../src/core/PlayerAudioEngine.ts","../src/sync/SocketManager.ts","../src/utils/throttle.ts","../src/ui/SoundMixerApp.ts","../src/ui/PlayerVolumePanel.ts","../src/module.ts"],"sourcesContent":["const PREFIX = 'ASE';\n\nexport const Logger = {\n  info: (message: string, ...args: unknown[]) => {\n    console.log(`${PREFIX} | ${message}`, ...args);\n  },\n  \n  warn: (message: string, ...args: unknown[]) => {\n    console.warn(`${PREFIX} | ${message}`, ...args);\n  },\n  \n  error: (message: string, ...args: unknown[]) => {\n    console.error(`${PREFIX} | ${message}`, ...args);\n  },\n  \n  debug: (message: string, ...args: unknown[]) => {\n    if (CONFIG?.debug?.audio) {\n      console.debug(`${PREFIX} | ${message}`, ...args);\n    }\n  }\n};","import type { TrackGroup, PlaybackState } from '@t/audio';\nimport { Logger } from '@utils/logger';\n\nexport class StreamingPlayer {\n  readonly id: string;\n  private ctx: AudioContext;\n  private _group: TrackGroup;\n  private _url: string = '';\n  \n  private audio: HTMLAudioElement;\n  private sourceNode: MediaElementAudioSourceNode | null = null;\n  private gainNode: GainNode;\n  private outputNode: GainNode;\n  \n  private _state: PlaybackState = 'stopped';\n  private _volume: number = 1;\n  private _loop: boolean = false;\n  private _ready: boolean = false;\n\n  constructor(\n    id: string,\n    ctx: AudioContext,\n    channelOutput: GainNode,\n    group: TrackGroup = 'music'\n  ) {\n    this.id = id;\n    this.ctx = ctx;\n    this._group = group;\n    \n    this.audio = new Audio();\n    this.audio.crossOrigin = 'anonymous';\n    this.audio.preload = 'auto';\n    \n    this.gainNode = ctx.createGain();\n    this.outputNode = ctx.createGain();\n    \n    this.gainNode.connect(this.outputNode);\n    this.outputNode.connect(channelOutput);\n    \n    this.setupAudioEvents();\n  }\n\n  private setupAudioEvents(): void {\n    this.audio.addEventListener('canplay', () => {\n      this._ready = true;\n      if (this._state === 'loading') {\n        this._state = 'stopped';\n      }\n      Logger.debug(`Track ${this.id} ready to play`);\n    });\n\n    this.audio.addEventListener('ended', () => {\n      if (!this._loop) {\n        this._state = 'stopped';\n        Logger.debug(`Track ${this.id} ended`);\n      }\n    });\n\n    this.audio.addEventListener('error', (e) => {\n      Logger.error(`Track ${this.id} error:`, this.audio.error);\n      this._state = 'stopped';\n    });\n  }\n\n  get state(): PlaybackState {\n    return this._state;\n  }\n\n  get group(): TrackGroup {\n    return this._group;\n  }\n\n  get url(): string {\n    return this._url;\n  }\n\n  get volume(): number {\n    return this._volume;\n  }\n\n  get loop(): boolean {\n    return this._loop;\n  }\n\n  get ready(): boolean {\n    return this._ready;\n  }\n\n  async load(url: string): Promise<void> {\n    this._state = 'loading';\n    this._url = url;\n    this._ready = false;\n\n    return new Promise((resolve, reject) => {\n      const onCanPlay = () => {\n        this.audio.removeEventListener('canplay', onCanPlay);\n        this.audio.removeEventListener('error', onError);\n        \n        // Connect to Web Audio\n        if (!this.sourceNode) {\n          this.sourceNode = this.ctx.createMediaElementSource(this.audio);\n          this.sourceNode.connect(this.gainNode);\n        }\n        \n        this._ready = true;\n        this._state = 'stopped';\n        Logger.debug(`Track loaded: ${this.id}`);\n        resolve();\n      };\n\n      const onError = () => {\n        this.audio.removeEventListener('canplay', onCanPlay);\n        this.audio.removeEventListener('error', onError);\n        this._state = 'stopped';\n        reject(new Error(`Failed to load: ${url}`));\n      };\n\n      this.audio.addEventListener('canplay', onCanPlay, { once: true });\n      this.audio.addEventListener('error', onError, { once: true });\n      \n      this.audio.src = url;\n      this.audio.load();\n    });\n  }\n\n  async play(offset: number = 0): Promise<void> {\n    if (!this._ready) {\n      Logger.warn(`Track ${this.id} not ready`);\n      return;\n    }\n\n    try {\n      this.audio.currentTime = Math.max(0, Math.min(offset, this.audio.duration || 0));\n      this.audio.loop = this._loop;\n      await this.audio.play();\n      this._state = 'playing';\n      Logger.debug(`Track ${this.id} playing from ${offset.toFixed(2)}s`);\n    } catch (error) {\n      Logger.error(`Failed to play ${this.id}:`, error);\n    }\n  }\n\n  pause(): void {\n    if (this._state !== 'playing') return;\n    \n    this.audio.pause();\n    this._state = 'paused';\n    Logger.debug(`Track ${this.id} paused at ${this.audio.currentTime.toFixed(2)}s`);\n  }\n\n  stop(): void {\n    this.audio.pause();\n    this.audio.currentTime = 0;\n    this._state = 'stopped';\n    Logger.debug(`Track ${this.id} stopped`);\n  }\n\n  seek(time: number): void {\n    const safeTime = Math.max(0, Math.min(time, this.audio.duration || 0));\n    this.audio.currentTime = safeTime;\n  }\n\n  setVolume(value: number): void {\n    this._volume = Math.max(0, Math.min(1, value));\n    this.gainNode.gain.setValueAtTime(this._volume, this.ctx.currentTime);\n  }\n\n  setLoop(value: boolean): void {\n    this._loop = value;\n    this.audio.loop = value;\n  }\n\n  setChannel(newGroup: TrackGroup, newOutput: GainNode): void {\n    this._group = newGroup;\n    this.outputNode.disconnect();\n    this.outputNode.connect(newOutput);\n  }\n\n  getCurrentTime(): number {\n    return this.audio.currentTime;\n  }\n\n  getDuration(): number {\n    return this.audio.duration || 0;\n  }\n\n  getState() {\n    return {\n      id: this.id,\n      url: this._url,\n      group: this._group,\n      playbackState: this._state,\n      volume: this._volume,\n      loop: this._loop,\n      currentTime: this.getCurrentTime(),\n      duration: this.getDuration()\n    };\n  }\n\n  dispose(): void {\n    this.audio.pause();\n    this.audio.src = '';\n    this.sourceNode?.disconnect();\n    this.gainNode.disconnect();\n    this.outputNode.disconnect();\n    Logger.debug(`Track ${this.id} disposed`);\n  }\n}","/**\n * Get current server time (for sync calculations)\n */\nexport function getServerTime(): number {\n  // Foundry's game.time.serverTime учитывает offset\n  return Date.now();\n}\n\n/**\n * Calculate playback offset based on start time\n */\nexport function calculateOffset(startedAt: number, pausedAt: number = 0): number {\n  if (pausedAt > 0) {\n    return pausedAt;\n  }\n  return (getServerTime() - startedAt) / 1000;\n}\n\n/**\n * Format seconds to mm:ss\n */\nexport function formatTime(seconds: number): string {\n  if (!isFinite(seconds) || seconds < 0) return '0:00';\n  \n  const mins = Math.floor(seconds / 60);\n  const secs = Math.floor(seconds % 60);\n  return `${mins}:${secs.toString().padStart(2, '0')}`;\n}","import type { TrackConfig, TrackState, MixerState, TrackGroup, ChannelVolumes } from '@t/audio';\nimport { StreamingPlayer } from './StreamingPlayer';\nimport { Logger } from '@utils/logger';\nimport { getServerTime } from '@utils/time';\n\nconst MODULE_ID = 'advanced-sound-engine';\nconst MAX_SIMULTANEOUS = 8;\n\nexport class AudioEngine {\n  private ctx: AudioContext;\n  private masterGain: GainNode;\n  private channelGains: Record<TrackGroup, GainNode>;\n  private players: Map<string, StreamingPlayer> = new Map();\n  \n  private _volumes: ChannelVolumes = {\n    master: 1,\n    music: 1,\n    ambience: 1,\n    sfx: 1\n  };\n  \n  private saveTimeout: ReturnType<typeof setTimeout> | null = null;\n\n  constructor() {\n    this.ctx = new AudioContext();\n    \n    this.masterGain = this.ctx.createGain();\n    this.masterGain.connect(this.ctx.destination);\n    \n    this.channelGains = {\n      music: this.ctx.createGain(),\n      ambience: this.ctx.createGain(),\n      sfx: this.ctx.createGain()\n    };\n    \n    this.channelGains.music.connect(this.masterGain);\n    this.channelGains.ambience.connect(this.masterGain);\n    this.channelGains.sfx.connect(this.masterGain);\n    \n    Logger.info('AudioEngine initialized');\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Persistence (GM only)\n  // ─────────────────────────────────────────────────────────────\n\n  private scheduleSave(): void {\n    if (!game.user?.isGM) return;\n    \n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout);\n    }\n    this.saveTimeout = setTimeout(() => {\n      this.saveState();\n    }, 500);\n  }\n\n  private async saveState(): Promise<void> {\n    if (!game.ready || !game.user?.isGM) return;\n    \n    const state = this.getState();\n    \n    try {\n      await game.settings.set(MODULE_ID, 'mixerState', JSON.stringify(state));\n      Logger.debug('Mixer state saved');\n    } catch (error) {\n      Logger.error('Failed to save mixer state:', error);\n    }\n  }\n\n  async loadSavedState(): Promise<void> {\n    if (!game.ready) return;\n    \n    try {\n      const savedJson = game.settings.get(MODULE_ID, 'mixerState') as string;\n      if (!savedJson) return;\n      \n      const state = JSON.parse(savedJson) as MixerState;\n      await this.restoreState(state);\n      \n      Logger.info('Mixer state restored');\n    } catch (error) {\n      Logger.error('Failed to load mixer state:', error);\n    }\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Track Management\n  // ─────────────────────────────────────────────────────────────\n\n  async createTrack(config: TrackConfig): Promise<StreamingPlayer> {\n    if (this.players.has(config.id)) {\n      return this.players.get(config.id)!;\n    }\n\n    const channelOutput = this.channelGains[config.group];\n    \n    const player = new StreamingPlayer(\n      config.id,\n      this.ctx,\n      channelOutput,\n      config.group\n    );\n\n    if (config.volume !== undefined) {\n      player.setVolume(config.volume);\n    }\n    if (config.loop !== undefined) {\n      player.setLoop(config.loop);\n    }\n\n    await player.load(config.url);\n\n    this.players.set(config.id, player);\n    this.scheduleSave();\n    \n    Logger.info(`Track created: ${config.id}`);\n    return player;\n  }\n\n  getTrack(id: string): StreamingPlayer | undefined {\n    return this.players.get(id);\n  }\n\n  removeTrack(id: string): boolean {\n    const player = this.players.get(id);\n    if (!player) return false;\n\n    player.dispose();\n    this.players.delete(id);\n    this.scheduleSave();\n    \n    Logger.info(`Track removed: ${id}`);\n    return true;\n  }\n\n  getAllTracks(): StreamingPlayer[] {\n    return Array.from(this.players.values());\n  }\n\n  getTracksByGroup(group: TrackGroup): StreamingPlayer[] {\n    return this.getAllTracks().filter(t => t.group === group);\n  }\n\n  setTrackChannel(id: string, newGroup: TrackGroup): void {\n    const player = this.players.get(id);\n    if (!player) return;\n    \n    player.setChannel(newGroup, this.channelGains[newGroup]);\n    this.scheduleSave();\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Playback Control\n  // ─────────────────────────────────────────────────────────────\n\n  async playTrack(id: string, offset: number = 0): Promise<void> {\n    const player = this.players.get(id);\n    if (!player) {\n      Logger.warn(`Track not found: ${id}`);\n      return;\n    }\n    \n    const playingCount = this.getAllTracks().filter(t => t.state === 'playing').length;\n    const isCurrentlyPlaying = player.state === 'playing';\n    \n    if (!isCurrentlyPlaying && playingCount >= MAX_SIMULTANEOUS) {\n      Logger.warn(`Maximum simultaneous tracks (${MAX_SIMULTANEOUS}) reached`);\n      ui.notifications?.warn(`Cannot play more than ${MAX_SIMULTANEOUS} tracks simultaneously`);\n      return;\n    }\n    \n    await player.play(offset);\n  }\n\n  pauseTrack(id: string): void {\n    this.players.get(id)?.pause();\n  }\n\n  stopTrack(id: string): void {\n    this.players.get(id)?.stop();\n  }\n\n  seekTrack(id: string, time: number): void {\n    this.players.get(id)?.seek(time);\n  }\n\n  setTrackVolume(id: string, volume: number): void {\n    this.players.get(id)?.setVolume(volume);\n    this.scheduleSave();\n  }\n\n  setTrackLoop(id: string, loop: boolean): void {\n    this.players.get(id)?.setLoop(loop);\n    this.scheduleSave();\n  }\n\n  stopAll(): void {\n    for (const player of this.players.values()) {\n      player.stop();\n    }\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Volume Control\n  // ─────────────────────────────────────────────────────────────\n\n  get volumes(): ChannelVolumes {\n    return { ...this._volumes };\n  }\n\n  setMasterVolume(value: number): void {\n    this._volumes.master = Math.max(0, Math.min(1, value));\n    this.masterGain.gain.linearRampToValueAtTime(\n      this._volumes.master,\n      this.ctx.currentTime + 0.01\n    );\n    this.scheduleSave();\n  }\n\n  setChannelVolume(channel: TrackGroup, value: number): void {\n    this._volumes[channel] = Math.max(0, Math.min(1, value));\n    this.channelGains[channel].gain.linearRampToValueAtTime(\n      this._volumes[channel],\n      this.ctx.currentTime + 0.01\n    );\n    this.scheduleSave();\n  }\n\n  getChannelVolume(channel: TrackGroup): number {\n    return this._volumes[channel];\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // State\n  // ─────────────────────────────────────────────────────────────\n\n  getState(): MixerState {\n    const tracks: TrackState[] = [];\n    \n    for (const player of this.players.values()) {\n      tracks.push(player.getState());\n    }\n\n    return {\n      masterVolume: this._volumes.master,\n      channelVolumes: { ...this._volumes },\n      tracks,\n      timestamp: getServerTime(),\n      syncEnabled: false\n    };\n  }\n\n  async restoreState(state: MixerState): Promise<void> {\n    // Restore volumes\n    this._volumes.master = state.masterVolume;\n    this.masterGain.gain.setValueAtTime(this._volumes.master, this.ctx.currentTime);\n    \n    if (state.channelVolumes) {\n      for (const channel of ['music', 'ambience', 'sfx'] as TrackGroup[]) {\n        this._volumes[channel] = state.channelVolumes[channel];\n        this.channelGains[channel].gain.setValueAtTime(this._volumes[channel], this.ctx.currentTime);\n      }\n    }\n\n    // Restore tracks (without playing)\n    for (const trackState of state.tracks) {\n      if (!this.players.has(trackState.id)) {\n        try {\n          await this.createTrack({\n            id: trackState.id,\n            url: trackState.url,\n            group: trackState.group,\n            volume: trackState.volume,\n            loop: trackState.loop\n          });\n        } catch (error) {\n          Logger.error(`Failed to restore track ${trackState.id}:`, error);\n        }\n      }\n    }\n\n    // Remove tracks not in state\n    const stateTrackIds = new Set(state.tracks.map(t => t.id));\n    for (const [id] of this.players) {\n      if (!stateTrackIds.has(id)) {\n        this.removeTrack(id);\n      }\n    }\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Audio Context\n  // ─────────────────────────────────────────────────────────────\n\n  async resume(): Promise<void> {\n    if (this.ctx.state === 'suspended') {\n      await this.ctx.resume();\n      Logger.info('AudioContext resumed');\n    }\n  }\n\n  get contextState(): AudioContextState {\n    return this.ctx.state;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Cleanup\n  // ─────────────────────────────────────────────────────────────\n\n  dispose(): void {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout);\n    }\n    for (const player of this.players.values()) {\n      player.dispose();\n    }\n    this.players.clear();\n    this.ctx.close();\n    Logger.info('AudioEngine disposed');\n  }\n}","import type { TrackGroup, ChannelVolumes, SyncTrackState, TrackPlayPayload } from '@t/audio';\nimport { StreamingPlayer } from './StreamingPlayer';\nimport { Logger } from '@utils/logger';\nimport { getServerTime } from '@utils/time';\n\n/**\n * Упрощенный движок для игроков — только получает команды\n */\nexport class PlayerAudioEngine {\n  private ctx: AudioContext;\n  private masterGain: GainNode;\n  private gmGain: GainNode; // Громкость от GM\n  private channelGains: Record<TrackGroup, GainNode>;\n  private players: Map<string, StreamingPlayer> = new Map();\n  \n  private _localVolume: number = 1; // Личная громкость игрока\n  private _gmVolumes: ChannelVolumes = {\n    master: 1,\n    music: 1,\n    ambience: 1,\n    sfx: 1\n  };\n\n  constructor() {\n    this.ctx = new AudioContext();\n    \n    // Chain: tracks -> channels -> gmGain -> masterGain -> destination\n    this.masterGain = this.ctx.createGain();\n    this.masterGain.connect(this.ctx.destination);\n    \n    this.gmGain = this.ctx.createGain();\n    this.gmGain.connect(this.masterGain);\n    \n    this.channelGains = {\n      music: this.ctx.createGain(),\n      ambience: this.ctx.createGain(),\n      sfx: this.ctx.createGain()\n    };\n    \n    this.channelGains.music.connect(this.gmGain);\n    this.channelGains.ambience.connect(this.gmGain);\n    this.channelGains.sfx.connect(this.gmGain);\n    \n    Logger.info('PlayerAudioEngine initialized');\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Local Volume (Player's personal control)\n  // ─────────────────────────────────────────────────────────────\n\n  get localVolume(): number {\n    return this._localVolume;\n  }\n\n  setLocalVolume(value: number): void {\n    this._localVolume = Math.max(0, Math.min(1, value));\n    this.masterGain.gain.linearRampToValueAtTime(\n      this._localVolume,\n      this.ctx.currentTime + 0.01\n    );\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // GM Volume (from sync)\n  // ─────────────────────────────────────────────────────────────\n\n  setGMVolume(channel: TrackGroup | 'master', value: number): void {\n    const safeValue = Math.max(0, Math.min(1, value));\n    \n    if (channel === 'master') {\n      this._gmVolumes.master = safeValue;\n      this.gmGain.gain.linearRampToValueAtTime(safeValue, this.ctx.currentTime + 0.01);\n    } else {\n      this._gmVolumes[channel] = safeValue;\n      this.channelGains[channel].gain.linearRampToValueAtTime(safeValue, this.ctx.currentTime + 0.01);\n    }\n  }\n\n  setAllGMVolumes(volumes: ChannelVolumes): void {\n    this._gmVolumes = { ...volumes };\n    \n    this.gmGain.gain.setValueAtTime(volumes.master, this.ctx.currentTime);\n    this.channelGains.music.gain.setValueAtTime(volumes.music, this.ctx.currentTime);\n    this.channelGains.ambience.gain.setValueAtTime(volumes.ambience, this.ctx.currentTime);\n    this.channelGains.sfx.gain.setValueAtTime(volumes.sfx, this.ctx.currentTime);\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Track Commands (from GM via socket)\n  // ─────────────────────────────────────────────────────────────\n\n  async handlePlay(payload: TrackPlayPayload): Promise<void> {\n    let player = this.players.get(payload.trackId);\n    \n    // Create if doesn't exist\n    if (!player) {\n      player = new StreamingPlayer(\n        payload.trackId,\n        this.ctx,\n        this.channelGains[payload.group],\n        payload.group\n      );\n      \n      await player.load(payload.url);\n      this.players.set(payload.trackId, player);\n    }\n    \n    player.setVolume(payload.volume);\n    player.setLoop(payload.loop);\n    \n    // Calculate offset based on time elapsed since GM started\n    const elapsed = (getServerTime() - payload.startTimestamp) / 1000;\n    const adjustedOffset = Math.max(0, payload.offset + elapsed);\n    \n    await player.play(adjustedOffset);\n    Logger.debug(`Player: track ${payload.trackId} playing at ${adjustedOffset.toFixed(2)}s`);\n  }\n\n  handlePause(trackId: string): void {\n    this.players.get(trackId)?.pause();\n  }\n\n  handleStop(trackId: string): void {\n    this.players.get(trackId)?.stop();\n  }\n\n  handleSeek(trackId: string, time: number, isPlaying: boolean, seekTimestamp: number): void {\n    const player = this.players.get(trackId);\n    if (!player) return;\n    \n    if (isPlaying) {\n      const elapsed = (getServerTime() - seekTimestamp) / 1000;\n      player.seek(time + elapsed);\n    } else {\n      player.seek(time);\n    }\n  }\n\n  handleTrackVolume(trackId: string, volume: number): void {\n    this.players.get(trackId)?.setVolume(volume);\n  }\n\n  handleTrackLoop(trackId: string, loop: boolean): void {\n    this.players.get(trackId)?.setLoop(loop);\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Sync State (full state from GM)\n  // ─────────────────────────────────────────────────────────────\n\n  async syncState(tracks: SyncTrackState[], volumes: ChannelVolumes): Promise<void> {\n    // Set volumes\n    this.setAllGMVolumes(volumes);\n    \n    // Handle tracks\n    const newTrackIds = new Set(tracks.map(t => t.id));\n    \n    // Remove tracks not in sync\n    for (const [id, player] of this.players) {\n      if (!newTrackIds.has(id)) {\n        player.dispose();\n        this.players.delete(id);\n      }\n    }\n    \n    // Add/update tracks\n    for (const trackState of tracks) {\n      let player = this.players.get(trackState.id);\n      \n      if (!player) {\n        player = new StreamingPlayer(\n          trackState.id,\n          this.ctx,\n          this.channelGains[trackState.group],\n          trackState.group\n        );\n        \n        await player.load(trackState.url);\n        this.players.set(trackState.id, player);\n      }\n      \n      player.setVolume(trackState.volume);\n      player.setLoop(trackState.loop);\n      \n      if (trackState.isPlaying) {\n        const elapsed = (getServerTime() - trackState.startTimestamp) / 1000;\n        const adjustedTime = trackState.currentTime + elapsed;\n        await player.play(adjustedTime);\n      } else {\n        player.stop();\n      }\n    }\n    \n    Logger.info('Player: synced state from GM');\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Sync Off\n  // ─────────────────────────────────────────────────────────────\n\n  stopAll(): void {\n    for (const player of this.players.values()) {\n      player.stop();\n    }\n  }\n\n  clearAll(): void {\n    for (const player of this.players.values()) {\n      player.dispose();\n    }\n    this.players.clear();\n    Logger.info('Player: all tracks cleared');\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Audio Context\n  // ─────────────────────────────────────────────────────────────\n\n  async resume(): Promise<void> {\n    if (this.ctx.state === 'suspended') {\n      await this.ctx.resume();\n      Logger.info('PlayerAudioEngine: AudioContext resumed');\n    }\n  }\n\n  dispose(): void {\n    this.clearAll();\n    this.ctx.close();\n    Logger.info('PlayerAudioEngine disposed');\n  }\n}","import type { \n  SocketMessage, \n  SocketMessageType,\n  SyncStatePayload,\n  SyncTrackState,\n  TrackPlayPayload,\n  TrackPausePayload,\n  TrackStopPayload,\n  TrackSeekPayload,\n  TrackVolumePayload,\n  TrackLoopPayload,\n  ChannelVolumePayload,\n  TrackGroup,\n  ChannelVolumes\n} from '@t/audio';\nimport { AudioEngine } from '@core/AudioEngine';\nimport { PlayerAudioEngine } from '@core/PlayerAudioEngine';\nimport { Logger } from '@utils/logger';\nimport { getServerTime } from '@utils/time';\n\nconst MODULE_ID = 'advanced-sound-engine';\nconst SOCKET_NAME = `module.${MODULE_ID}`;\n\nexport class SocketManager {\n  private gmEngine: AudioEngine | null = null;\n  private playerEngine: PlayerAudioEngine | null = null;\n  private socket: any = null;\n  private _syncEnabled: boolean = false;\n  private isGM: boolean = false;\n\n  constructor() {}\n\n  initializeAsGM(engine: AudioEngine): void {\n    this.isGM = true;\n    this.gmEngine = engine;\n    this.socket = game.socket;\n    \n    this.socket?.on(SOCKET_NAME, (message: SocketMessage) => {\n      this.handleGMMessage(message);\n    });\n    \n    Logger.info('SocketManager initialized as GM');\n  }\n\n  initializeAsPlayer(engine: PlayerAudioEngine): void {\n    this.isGM = false;\n    this.playerEngine = engine;\n    this.socket = game.socket;\n    \n    this.socket?.on(SOCKET_NAME, (message: SocketMessage) => {\n      this.handlePlayerMessage(message);\n    });\n    \n    // Request current state on join\n    setTimeout(() => {\n      this.send('player-ready', {});\n    }, 1000);\n    \n    Logger.info('SocketManager initialized as Player');\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Sync Mode (GM)\n  // ─────────────────────────────────────────────────────────────\n\n  get syncEnabled(): boolean {\n    return this._syncEnabled;\n  }\n\n  setSyncEnabled(enabled: boolean): void {\n    if (!this.isGM) return;\n    \n    this._syncEnabled = enabled;\n    \n    if (enabled) {\n      this.broadcastSyncStart();\n    } else {\n      this.broadcastSyncStop();\n    }\n    \n    Logger.info(`Sync mode: ${enabled ? 'ON' : 'OFF'}`);\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // GM Message Handling\n  // ─────────────────────────────────────────────────────────────\n\n  private handleGMMessage(message: SocketMessage): void {\n    if (message.senderId === game.user?.id) return;\n    \n    if (message.type === 'player-ready' && this._syncEnabled) {\n      // Send current state to newly joined player\n      this.sendStateTo(message.senderId);\n    }\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // Player Message Handling\n  // ─────────────────────────────────────────────────────────────\n\n  private async handlePlayerMessage(message: SocketMessage): Promise<void> {\n    if (message.senderId === game.user?.id) return;\n    if (!this.playerEngine) return;\n    \n    Logger.debug(`Player received: ${message.type}`, message.payload);\n    \n    switch (message.type) {\n      case 'sync-start':\n        const startPayload = message.payload as SyncStatePayload;\n        await this.playerEngine.syncState(startPayload.tracks, startPayload.channelVolumes);\n        break;\n        \n      case 'sync-stop':\n        this.playerEngine.clearAll();\n        break;\n        \n      case 'sync-state':\n        const statePayload = message.payload as SyncStatePayload;\n        await this.playerEngine.syncState(statePayload.tracks, statePayload.channelVolumes);\n        break;\n        \n      case 'track-play':\n        const playPayload = message.payload as TrackPlayPayload;\n        await this.playerEngine.handlePlay(playPayload);\n        break;\n        \n      case 'track-pause':\n        const pausePayload = message.payload as TrackPausePayload;\n        this.playerEngine.handlePause(pausePayload.trackId);\n        break;\n        \n      case 'track-stop':\n        const stopPayload = message.payload as TrackStopPayload;\n        this.playerEngine.handleStop(stopPayload.trackId);\n        break;\n        \n      case 'track-seek':\n        const seekPayload = message.payload as TrackSeekPayload;\n        this.playerEngine.handleSeek(\n          seekPayload.trackId, \n          seekPayload.time, \n          seekPayload.isPlaying,\n          seekPayload.seekTimestamp\n        );\n        break;\n        \n      case 'track-volume':\n        const volPayload = message.payload as TrackVolumePayload;\n        this.playerEngine.handleTrackVolume(volPayload.trackId, volPayload.volume);\n        break;\n        \n      case 'track-loop':\n        const loopPayload = message.payload as TrackLoopPayload;\n        this.playerEngine.handleTrackLoop(loopPayload.trackId, loopPayload.loop);\n        break;\n        \n      case 'channel-volume':\n        const chVolPayload = message.payload as ChannelVolumePayload;\n        this.playerEngine.setGMVolume(chVolPayload.channel, chVolPayload.volume);\n        break;\n        \n      case 'stop-all':\n        this.playerEngine.stopAll();\n        break;\n    }\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // GM Broadcast Methods\n  // ─────────────────────────────────────────────────────────────\n\n  private send(type: SocketMessageType, payload: unknown, targetUserId?: string): void {\n    if (!this.socket) return;\n\n    const message: SocketMessage = {\n      type,\n      payload,\n      senderId: game.user?.id ?? '',\n      timestamp: getServerTime()\n    };\n\n    if (targetUserId) {\n      this.socket.emit(SOCKET_NAME, message, { recipients: [targetUserId] });\n    } else {\n      this.socket.emit(SOCKET_NAME, message);\n    }\n\n    Logger.debug(`Sent: ${type}`, payload);\n  }\n\n  private getCurrentSyncState(): SyncStatePayload {\n    if (!this.gmEngine) {\n      return { tracks: [], channelVolumes: { master: 1, music: 1, ambience: 1, sfx: 1 } };\n    }\n    \n    const now = getServerTime();\n    const tracks: SyncTrackState[] = [];\n    \n    for (const player of this.gmEngine.getAllTracks()) {\n      const state = player.getState();\n      tracks.push({\n        id: state.id,\n        url: state.url,\n        group: state.group,\n        volume: state.volume,\n        loop: state.loop,\n        isPlaying: state.playbackState === 'playing',\n        currentTime: player.getCurrentTime(),\n        startTimestamp: now\n      });\n    }\n    \n    return {\n      tracks,\n      channelVolumes: this.gmEngine.volumes\n    };\n  }\n\n  private broadcastSyncStart(): void {\n    const state = this.getCurrentSyncState();\n    this.send('sync-start', state);\n  }\n\n  private broadcastSyncStop(): void {\n    this.send('sync-stop', {});\n  }\n\n  private sendStateTo(userId: string): void {\n    const state = this.getCurrentSyncState();\n    this.send('sync-state', state, userId);\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // GM Actions (called when GM interacts with mixer)\n  // ─────────────────────────────────────────────────────────────\n\n  broadcastTrackPlay(trackId: string, offset: number): void {\n    if (!this._syncEnabled || !this.gmEngine) return;\n    \n    const player = this.gmEngine.getTrack(trackId);\n    if (!player) return;\n    \n    const payload: TrackPlayPayload = {\n      trackId,\n      url: player.url,\n      group: player.group,\n      volume: player.volume,\n      loop: player.loop,\n      offset,\n      startTimestamp: getServerTime()\n    };\n    \n    this.send('track-play', payload);\n  }\n\n  broadcastTrackPause(trackId: string, pausedAt: number): void {\n    if (!this._syncEnabled) return;\n    \n    const payload: TrackPausePayload = { trackId, pausedAt };\n    this.send('track-pause', payload);\n  }\n\n  broadcastTrackStop(trackId: string): void {\n    if (!this._syncEnabled) return;\n    \n    const payload: TrackStopPayload = { trackId };\n    this.send('track-stop', payload);\n  }\n\n  broadcastTrackSeek(trackId: string, time: number, isPlaying: boolean): void {\n    if (!this._syncEnabled) return;\n    \n    const payload: TrackSeekPayload = {\n      trackId,\n      time,\n      isPlaying,\n      seekTimestamp: getServerTime()\n    };\n    this.send('track-seek', payload);\n  }\n\n  broadcastTrackVolume(trackId: string, volume: number): void {\n    if (!this._syncEnabled) return;\n    \n    const payload: TrackVolumePayload = { trackId, volume };\n    this.send('track-volume', payload);\n  }\n\n  broadcastTrackLoop(trackId: string, loop: boolean): void {\n    if (!this._syncEnabled) return;\n    \n    const payload: TrackLoopPayload = { trackId, loop };\n    this.send('track-loop', payload);\n  }\n\n  broadcastChannelVolume(channel: TrackGroup | 'master', volume: number): void {\n    if (!this._syncEnabled) return;\n    \n    const payload: ChannelVolumePayload = { channel, volume };\n    this.send('channel-volume', payload);\n  }\n\n  broadcastStopAll(): void {\n    if (!this._syncEnabled) return;\n    this.send('stop-all', {});\n  }\n\n  dispose(): void {\n    this.socket?.off(SOCKET_NAME);\n  }\n}","export function throttle<T extends (...args: Parameters<T>) => void>(\n  fn: T,\n  delay: number\n): (...args: Parameters<T>) => void {\n  let lastCall = 0;\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n  \n  return function (this: ThisParameterType<T>, ...args: Parameters<T>) {\n    const now = Date.now();\n    const remaining = delay - (now - lastCall);\n    \n    if (remaining <= 0) {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n        timeoutId = null;\n      }\n      lastCall = now;\n      fn.apply(this, args);\n    } else if (!timeoutId) {\n      timeoutId = setTimeout(() => {\n        lastCall = Date.now();\n        timeoutId = null;\n        fn.apply(this, args);\n      }, remaining);\n    }\n  };\n}\n\nexport function debounce<T extends (...args: Parameters<T>) => void>(\n  fn: T,\n  delay: number\n): (...args: Parameters<T>) => void {\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n  \n  return function (this: ThisParameterType<T>, ...args: Parameters<T>) {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      fn.apply(this, args);\n    }, delay);\n  };\n}","import type { TrackGroup } from '@t/audio';\nimport { AudioEngine } from '@core/AudioEngine';\nimport { SocketManager } from '@sync/SocketManager';\nimport { StreamingPlayer } from '@core/StreamingPlayer';\nimport { Logger } from '@utils/logger';\nimport { formatTime } from '@utils/time';\nimport { throttle } from '@utils/throttle';\n\nconst MODULE_ID = 'advanced-sound-engine';\nconst MAX_SIMULTANEOUS = 8;\n\ninterface MixerData {\n  tracks: TrackViewData[];\n  volumes: {\n    master: number;\n    music: number;\n    ambience: number;\n    sfx: number;\n  };\n  playingCount: number;\n  maxSimultaneous: number;\n  syncEnabled: boolean;\n}\n\ninterface TrackViewData {\n  id: string;\n  name: string;\n  group: TrackGroup;\n  isPlaying: boolean;\n  isPaused: boolean;\n  isStopped: boolean;\n  isLoading: boolean;\n  volume: number;\n  volumePercent: number;\n  loop: boolean;\n  currentTime: number;\n  currentTimeFormatted: string;\n  duration: number;\n  durationFormatted: string;\n  progress: number;\n}\n\nexport class SoundMixerApp extends Application {\n  private engine: AudioEngine;\n  private socket: SocketManager;\n  private updateInterval: ReturnType<typeof setInterval> | null = null;\n\n  static override get defaultOptions(): ApplicationOptions {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'ase-sound-mixer',\n      title: 'Sound Mixer (GM)',\n      template: `modules/${MODULE_ID}/templates/mixer.hbs`,\n      classes: ['ase-mixer'],\n      width: 550,\n      height: 'auto',\n      resizable: true,\n      minimizable: true,\n      popOut: true\n    }) as ApplicationOptions;\n  }\n\n  constructor(engine: AudioEngine, socket: SocketManager, options?: Partial<ApplicationOptions>) {\n    super(options);\n    this.engine = engine;\n    this.socket = socket;\n  }\n\n  override getData(): MixerData {\n    const tracks = this.engine.getAllTracks().map(player => this.getTrackViewData(player));\n    const volumes = this.engine.volumes;\n    const playingCount = tracks.filter(t => t.isPlaying).length;\n    \n    return {\n      tracks,\n      volumes: {\n        master: Math.round(volumes.master * 100),\n        music: Math.round(volumes.music * 100),\n        ambience: Math.round(volumes.ambience * 100),\n        sfx: Math.round(volumes.sfx * 100)\n      },\n      playingCount,\n      maxSimultaneous: MAX_SIMULTANEOUS,\n      syncEnabled: this.socket.syncEnabled\n    };\n  }\n\n  private getTrackViewData(player: StreamingPlayer): TrackViewData {\n    const state = player.getState();\n    const currentTime = player.getCurrentTime();\n    const duration = player.getDuration();\n    \n    return {\n      id: state.id,\n      name: this.extractFileName(state.url),\n      group: state.group,\n      isPlaying: state.playbackState === 'playing',\n      isPaused: state.playbackState === 'paused',\n      isStopped: state.playbackState === 'stopped',\n      isLoading: state.playbackState === 'loading',\n      volume: state.volume,\n      volumePercent: Math.round(state.volume * 100),\n      loop: state.loop,\n      currentTime,\n      currentTimeFormatted: formatTime(currentTime),\n      duration,\n      durationFormatted: formatTime(duration),\n      progress: duration > 0 ? (currentTime / duration) * 100 : 0\n    };\n  }\n\n  private extractFileName(url: string): string {\n    if (!url) return 'Unknown';\n    try {\n      const decoded = decodeURIComponent(url);\n      const parts = decoded.split('/');\n      const fileName = parts[parts.length - 1];\n      return fileName.replace(/\\.[^.]+$/, '');\n    } catch {\n      const parts = url.split('/');\n      const fileName = parts[parts.length - 1];\n      return fileName.replace(/\\.[^.]+$/, '');\n    }\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n\n    // Sync toggle\n    html.find('#ase-sync-toggle').on('change', (event) => {\n      const enabled = (event.target as HTMLInputElement).checked;\n      this.socket.setSyncEnabled(enabled);\n      this.updateSyncIndicator(html, enabled);\n    });\n\n    // Channel volume sliders\n    const throttledChannelVolume = throttle((channel: string, value: number) => {\n      if (channel === 'master') {\n        this.engine.setMasterVolume(value);\n        this.socket.broadcastChannelVolume('master', value);\n      } else {\n        this.engine.setChannelVolume(channel as TrackGroup, value);\n        this.socket.broadcastChannelVolume(channel as TrackGroup, value);\n      }\n    }, 50);\n\n    html.find('.ase-channel-slider').on('input', (event) => {\n      const channel = $(event.currentTarget).data('channel') as string;\n      const value = parseFloat((event.target as HTMLInputElement).value) / 100;\n      throttledChannelVolume(channel, value);\n      $(event.currentTarget).siblings('.ase-channel-value').text(`${Math.round(value * 100)}%`);\n    });\n\n    // Add track\n    html.find('#ase-add-track').on('click', () => this.onAddTrack());\n\n    // Track controls\n    const tracks = html.find('.ase-tracks');\n    \n    tracks.on('click', '.ase-btn-play', (event) => {\n      const trackId = $(event.currentTarget).closest('.ase-track').data('track-id');\n      this.onPlayTrack(trackId);\n    });\n\n    tracks.on('click', '.ase-btn-pause', (event) => {\n      const trackId = $(event.currentTarget).closest('.ase-track').data('track-id');\n      this.onPauseTrack(trackId);\n    });\n\n    tracks.on('click', '.ase-btn-stop', (event) => {\n      const trackId = $(event.currentTarget).closest('.ase-track').data('track-id');\n      this.onStopTrack(trackId);\n    });\n\n    tracks.on('click', '.ase-btn-remove', (event) => {\n      const trackId = $(event.currentTarget).closest('.ase-track').data('track-id');\n      this.onRemoveTrack(trackId);\n    });\n\n    tracks.on('change', '.ase-loop-toggle', (event) => {\n      const trackId = $(event.currentTarget).closest('.ase-track').data('track-id');\n      const loop = (event.target as HTMLInputElement).checked;\n      this.engine.setTrackLoop(trackId, loop);\n      this.socket.broadcastTrackLoop(trackId, loop);\n    });\n\n    tracks.on('change', '.ase-channel-select', (event) => {\n      const trackId = $(event.currentTarget).data('track-id') as string;\n      const channel = (event.target as HTMLSelectElement).value as TrackGroup;\n      this.engine.setTrackChannel(trackId, channel);\n    });\n\n    // Volume slider\n    const throttledVolume = throttle((trackId: string, value: number) => {\n      this.engine.setTrackVolume(trackId, value);\n      this.socket.broadcastTrackVolume(trackId, value);\n    }, 50);\n\n    tracks.on('input', '.ase-volume-slider', (event) => {\n      const trackId = $(event.currentTarget).closest('.ase-track').data('track-id');\n      const value = parseFloat((event.target as HTMLInputElement).value) / 100;\n      throttledVolume(trackId, value);\n      $(event.currentTarget).siblings('.ase-volume-value').text(`${Math.round(value * 100)}%`);\n    });\n\n    // Seek slider\n    const throttledSeek = throttle((trackId: string, time: number) => {\n      const player = this.engine.getTrack(trackId);\n      const isPlaying = player?.state === 'playing';\n      this.engine.seekTrack(trackId, time);\n      this.socket.broadcastTrackSeek(trackId, time, isPlaying ?? false);\n    }, 100);\n\n    tracks.on('input', '.ase-seek-slider', (event) => {\n      const trackId = $(event.currentTarget).closest('.ase-track').data('track-id');\n      const player = this.engine.getTrack(trackId);\n      if (player) {\n        const percent = parseFloat((event.target as HTMLInputElement).value);\n        const time = (percent / 100) * player.getDuration();\n        throttledSeek(trackId, time);\n      }\n    });\n\n    // Stop all\n    html.find('#ase-stop-all').on('click', () => {\n      this.engine.stopAll();\n      this.socket.broadcastStopAll();\n      this.render();\n    });\n\n    this.startUpdates();\n  }\n\n  private updateSyncIndicator(html: JQuery, enabled: boolean): void {\n    const indicator = html.find('.ase-sync-status');\n    indicator.toggleClass('is-active', enabled);\n    indicator.find('span').text(enabled ? 'SYNC ON' : 'SYNC OFF');\n  }\n\n  private startUpdates(): void {\n    this.stopUpdates();\n    this.updateInterval = setInterval(() => {\n      this.updateTrackDisplays();\n    }, 250);\n  }\n\n  private stopUpdates(): void {\n    if (this.updateInterval) {\n      clearInterval(this.updateInterval);\n      this.updateInterval = null;\n    }\n  }\n\n  private updateTrackDisplays(): void {\n    const html = this.element;\n    if (!html || !html.length) return;\n\n    let playingCount = 0;\n\n    for (const player of this.engine.getAllTracks()) {\n      const trackEl = html.find(`.ase-track[data-track-id=\"${player.id}\"]`);\n      if (!trackEl.length) continue;\n\n      const currentTime = player.getCurrentTime();\n      const duration = player.getDuration();\n      const progress = duration > 0 ? (currentTime / duration) * 100 : 0;\n      const state = player.state;\n\n      if (state === 'playing') playingCount++;\n\n      trackEl.find('.ase-time-current').text(formatTime(currentTime));\n      \n      const seekSlider = trackEl.find('.ase-seek-slider');\n      if (!seekSlider.is(':active')) {\n        seekSlider.val(progress);\n      }\n\n      trackEl.removeClass('is-playing is-paused is-stopped is-loading');\n      trackEl.addClass(`is-${state}`);\n      \n      trackEl.find('.ase-btn-play').prop('disabled', state === 'playing' || state === 'loading');\n      trackEl.find('.ase-btn-pause').prop('disabled', state !== 'playing');\n      trackEl.find('.ase-btn-stop').prop('disabled', state === 'stopped');\n    }\n\n    const totalTracks = this.engine.getAllTracks().length;\n    html.find('.ase-track-count').text(`${playingCount}/${totalTracks} playing`);\n  }\n\n  private async onAddTrack(): Promise<void> {\n    const fp = new FilePicker({\n      type: 'audio',\n      current: '',\n      callback: async (path: string) => {\n        await this.addTrackFromPath(path);\n      }\n    });\n    fp.render(true);\n  }\n\n  async addTrackFromPath(path: string, group: TrackGroup = 'music'): Promise<void> {\n    const trackId = `track-${Date.now()}`;\n    \n    try {\n      await this.engine.createTrack({\n        id: trackId,\n        url: path,\n        group,\n        volume: 1,\n        loop: false\n      });\n      \n      this.render();\n      ui.notifications?.info(`Added: ${this.extractFileName(path)}`);\n      \n    } catch (error) {\n      Logger.error('Failed to add track:', error);\n      ui.notifications?.error(`Failed to load: ${path}`);\n    }\n  }\n\n  private async onPlayTrack(trackId: string): Promise<void> {\n    const player = this.engine.getTrack(trackId);\n    if (!player) return;\n\n    const offset = player.state === 'paused' ? player.getCurrentTime() : 0;\n    await this.engine.playTrack(trackId, offset);\n    this.socket.broadcastTrackPlay(trackId, offset);\n  }\n\n  private onPauseTrack(trackId: string): void {\n    const player = this.engine.getTrack(trackId);\n    if (!player) return;\n    \n    const pausedAt = player.getCurrentTime();\n    this.engine.pauseTrack(trackId);\n    this.socket.broadcastTrackPause(trackId, pausedAt);\n  }\n\n  private onStopTrack(trackId: string): void {\n    this.engine.stopTrack(trackId);\n    this.socket.broadcastTrackStop(trackId);\n  }\n\n  private onRemoveTrack(trackId: string): void {\n    this.engine.removeTrack(trackId);\n    this.render();\n  }\n\n  override close(options?: Application.CloseOptions): Promise<void> {\n    this.stopUpdates();\n    return super.close(options);\n  }\n}","import { PlayerAudioEngine } from '@core/PlayerAudioEngine';\nimport { Logger } from '@utils/logger';\n\nconst MODULE_ID = 'advanced-sound-engine';\n\nexport class PlayerVolumePanel extends Application {\n  private engine: PlayerAudioEngine;\n\n  static override get defaultOptions(): ApplicationOptions {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'ase-player-volume',\n      title: 'Sound Volume',\n      template: `modules/${MODULE_ID}/templates/player-volume.hbs`,\n      classes: ['ase-player-panel'],\n      width: 200,\n      height: 'auto',\n      resizable: false,\n      minimizable: true,\n      popOut: true\n    }) as ApplicationOptions;\n  }\n\n  constructor(engine: PlayerAudioEngine, options?: Partial<ApplicationOptions>) {\n    super(options);\n    this.engine = engine;\n  }\n\n  override getData() {\n    return {\n      volume: Math.round(this.engine.localVolume * 100)\n    };\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n\n    html.find('.ase-volume-slider').on('input', (event) => {\n      const value = parseFloat((event.target as HTMLInputElement).value) / 100;\n      this.engine.setLocalVolume(value);\n      html.find('.ase-volume-value').text(`${Math.round(value * 100)}%`);\n      \n      // Save preference\n      this.saveVolume(value);\n    });\n  }\n\n  private saveVolume(value: number): void {\n    localStorage.setItem(`${MODULE_ID}-player-volume`, String(value));\n  }\n\n  static loadSavedVolume(): number {\n    const saved = localStorage.getItem(`${MODULE_ID}-player-volume`);\n    return saved ? parseFloat(saved) : 1;\n  }\n}","import '../styles/sound-engine.scss';\nimport { AudioEngine } from '@core/AudioEngine';\nimport { PlayerAudioEngine } from '@core/PlayerAudioEngine';\nimport { SocketManager } from '@sync/SocketManager';\nimport { SoundMixerApp } from '@ui/SoundMixerApp';\nimport { PlayerVolumePanel } from '@ui/PlayerVolumePanel';\nimport { Logger } from '@utils/logger';\n\nconst MODULE_ID = 'advanced-sound-engine';\n\n// GM\nlet gmEngine: AudioEngine | null = null;\nlet mixerApp: SoundMixerApp | null = null;\n\n// Player\nlet playerEngine: PlayerAudioEngine | null = null;\nlet volumePanel: PlayerVolumePanel | null = null;\n\n// Shared\nlet socketManager: SocketManager | null = null;\n\ndeclare global {\n  interface Window {\n    ASE: {\n      isGM: boolean;\n      openPanel: () => void;\n      engine?: AudioEngine | PlayerAudioEngine;\n      socket?: SocketManager;\n    };\n  }\n}\n\n// ─────────────────────────────────────────────────────────────\n// Control Button (в начале файла, после импортов)\n// ─────────────────────────────────────────────────────────────\n\nHooks.on('getSceneControlButtons', (controls: Record<string, any>) => {\n  console.log('ASE: Hook fired', controls);\n  \n  const isGM = game.user?.isGM ?? false;\n\n  // Добавляем к существующему контролу sounds\ncontrols['advanced-sound-engine'] = {\n  name: 'advanced-sound-engine',\n  title: isGM ? 'Sound Mixer' : 'Sound Volume',\n  icon: isGM ? 'fas fa-sliders-h' : 'fas fa-volume-up',\n  visible: true,\n  tools: {\n    'open-panel': {\n      name: 'open-panel',\n      title: isGM ? 'Sound Mixer' : 'Sound Volume',\n      icon: isGM ? 'fas fa-sliders-h' : 'fas fa-volume-up',\n      button: true,\n      onClick: () => window.ASE?.openPanel()\n    }\n  }\n};\n});\n// ─────────────────────────────────────────────────────────────\n// Initialization\n// ─────────────────────────────────────────────────────────────\n\nHooks.once('init', () => {\n  Logger.info('Initializing Advanced Sound Engine...');\n  registerSettings();\n});\n\nHooks.once('ready', async () => {\n  const isGM = game.user?.isGM ?? false;\n  Logger.info(`Starting Advanced Sound Engine (${isGM ? 'GM' : 'Player'})...`);\n  \n  socketManager = new SocketManager();\n  \n  if (isGM) {\n    await initializeGM();\n  } else {\n    await initializePlayer();\n  }\n  \n  window.ASE = {\n    isGM,\n    openPanel: isGM ? openMixer : openVolumePanel,\n    engine: isGM ? gmEngine ?? undefined : playerEngine ?? undefined,\n    socket: socketManager ?? undefined\n  };\n  \n  setupAutoplayHandler();\n    \n  Logger.info('Advanced Sound Engine ready');\n});\n\nasync function initializeGM(): Promise<void> {\n  gmEngine = new AudioEngine();\n  socketManager!.initializeAsGM(gmEngine);\n  \n  await gmEngine.loadSavedState();\n}\n\nasync function initializePlayer(): Promise<void> {\n  playerEngine = new PlayerAudioEngine();\n  socketManager!.initializeAsPlayer(playerEngine);\n  \n  // Restore saved local volume\n  const savedVolume = PlayerVolumePanel.loadSavedVolume();\n  playerEngine.setLocalVolume(savedVolume);\n}\n\n// ─────────────────────────────────────────────────────────────\n// Panels\n// ─────────────────────────────────────────────────────────────\n\nfunction openMixer(): void {\n  if (!gmEngine || !socketManager) return;\n  \n  if (mixerApp && mixerApp.rendered) {\n    mixerApp.bringToTop();\n  } else {\n    mixerApp = new SoundMixerApp(gmEngine, socketManager);\n    mixerApp.render(true);\n  }\n}\n\nfunction openVolumePanel(): void {\n  if (!playerEngine) return;\n  \n  if (volumePanel && volumePanel.rendered) {\n    volumePanel.bringToTop();\n  } else {\n    volumePanel = new PlayerVolumePanel(playerEngine);\n    volumePanel.render(true);\n  }\n}\n\n\n\n// ─────────────────────────────────────────────────────────────\n// Autoplay Policy Handler\n// ─────────────────────────────────────────────────────────────\n\nfunction setupAutoplayHandler(): void {\n  const resumeAudio = () => {\n    gmEngine?.resume();\n    playerEngine?.resume();\n  };\n  \n  document.addEventListener('click', resumeAudio, { once: true });\n  document.addEventListener('keydown', resumeAudio, { once: true });\n  \n  Hooks.once('canvasReady', resumeAudio);\n}\n\n// ─────────────────────────────────────────────────────────────\n// Settings\n// ─────────────────────────────────────────────────────────────\n\nfunction registerSettings(): void {\n  game.settings.register(MODULE_ID, 'mixerState', {\n    name: 'Mixer State',\n    hint: 'Internal storage for mixer state',\n    scope: 'world',\n    config: false,\n    type: String,\n    default: ''\n  });\n}\n\n// ─────────────────────────────────────────────────────────────\n// Cleanup\n// ─────────────────────────────────────────────────────────────\n\nHooks.once('closeGame', () => {\n  mixerApp?.close();\n  volumePanel?.close();\n  socketManager?.dispose();\n  gmEngine?.dispose();\n  playerEngine?.dispose();\n});"],"names":["PREFIX","Logger","message","args","_a","StreamingPlayer","id","ctx","channelOutput","group","__publicField","url","resolve","reject","onCanPlay","onError","offset","error","time","safeTime","value","newGroup","newOutput","getServerTime","formatTime","seconds","mins","secs","MODULE_ID","MAX_SIMULTANEOUS","AudioEngine","state","savedJson","config","player","playingCount","t","volume","loop","channel","tracks","trackState","stateTrackIds","PlayerAudioEngine","safeValue","volumes","payload","elapsed","adjustedOffset","trackId","isPlaying","seekTimestamp","newTrackIds","adjustedTime","SOCKET_NAME","SocketManager","engine","enabled","startPayload","statePayload","playPayload","pausePayload","stopPayload","seekPayload","volPayload","loopPayload","chVolPayload","type","targetUserId","now","userId","pausedAt","throttle","fn","delay","lastCall","timeoutId","remaining","SoundMixerApp","socket","options","currentTime","duration","parts","html","event","throttledChannelVolume","throttledVolume","throttledSeek","indicator","trackEl","progress","seekSlider","totalTracks","path","_b","PlayerVolumePanel","saved","gmEngine","mixerApp","playerEngine","volumePanel","socketManager","controls","isGM","registerSettings","initializeGM","initializePlayer","openMixer","openVolumePanel","setupAutoplayHandler","savedVolume","resumeAudio"],"mappings":"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"}