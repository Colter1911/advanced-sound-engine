{{!-- Mixer Tab Content - Reuses Library styles --}}
<div class="ase-workspace ase-mixer-workspace">

  {{!-- Left Column: Favorites Panel (Full Height) --}}
  <aside class="ase-sidebar">
    <div class="ase-sidebar-section ase-mixer-favorites">
      <div class="ase-sidebar-header">
        <span class="ase-sidebar-title"><i class="fa-solid fa-star"></i> Favorites</span>
      </div>
      <ul class="ase-list-group" data-section="mixer-favorites">
        {{#each favorites}}
        <li class="ase-list-item ase-favorite-item {{#if isPlaying}}is-playing{{else if isPaused}}is-paused{{/if}}"
          data-favorite-id="{{id}}" data-favorite-type="{{type}}" draggable="true">
          <div class="drag-handle drag-handle-sm" title="Drag to reorder">
            <i class="fa-solid fa-grip-vertical"></i>
          </div>
          <div class="ase-favorite-info">
            {{#if (eq type 'playlist')}}
            <i class="fa-solid fa-list ase-type-icon"></i>
            {{else}}
            {{#if (eq group 'sfx')}}
            <i class="fa-solid fa-bolt ase-type-icon"></i>
            {{else if (eq group 'ambience')}}
            <i class="fa-solid fa-cloud ase-type-icon"></i>
            {{else}}
            <i class="fa-solid fa-music ase-type-icon"></i>
            {{/if}}
            {{/if}}
            <span>{{name}}</span>
          </div>
          <div class="ase-icons">
            <i class="ase-icon-add-queue {{#if inQueue}}active{{/if}}" data-action="add-to-queue-from-favorite"
              data-favorite-id="{{id}}" data-favorite-type="{{type}}" title="Add to Queue"></i>
            <i class="fa-solid fa-play" data-action="play-favorite" data-favorite-id="{{id}}"
              data-favorite-type="{{type}}" title="Play"></i>
            <i class="fa-solid fa-stop" data-action="stop-favorite" data-favorite-id="{{id}}"
              data-favorite-type="{{type}}" title="Stop"></i>
          </div>
        </li>
        {{else}}
        <li class="ase-empty-message">
          <i class="fa-solid fa-star" style="opacity: 0.3;"></i>
          <span>No favorites</span>
        </li>
        {{/each}}
      </ul>
    </div>
  </aside>

  {{!-- Right Column: Playlist Queue --}}
  <main class="ase-content-area">
    <div class="ase-filters-bar">
      <span class="ase-sidebar-title"><i class="fa-solid fa-list"></i> Playback Queue</span>
    </div>

    <div class="ase-track-player-list" data-section="mixer-queue">
      {{#if queuePlaylists.length}}
      {{#each queuePlaylists}}
      <div class="ase-queue-playlist {{#if collapsed}}is-collapsed{{/if}}" data-playlist-id="{{id}}">
        {{!-- Playlist Header --}}
        <div class="ase-queue-playlist-header" data-action="toggle-playlist">
          <i class="fa-solid fa-chevron-down ase-collapse-icon"></i>
          <span class="ase-playlist-name">{{name}}</span>
          <span class="ase-playlist-count">({{tracks.length}} tracks)</span>
        </div>

        {{!-- Playlist Tracks --}}
        <div class="ase-queue-tracks">
          {{#each tracks}}
          {{!-- Show all if not collapsed, otherwise only playing/paused --}}
          <div
            class="ase-track-player-item ase-queue-track {{#if isPlaying}}is-playing{{else if isPaused}}is-paused{{/if}} {{#if shouldBeHidden}}collapsed-hidden{{/if}}"
            data-queue-id="{{queueId}}" data-item-id="{{libraryItemId}}" draggable="true">

            {{!-- Row 1: Identity (Handle + Icon + Info + Volume + Buttons + Delete) --}}
            <div class="track-identity-row">
              {{!-- Drag Handle --}}
              <div class="drag-handle" title="Drag to reorder">
                <i class="fa-solid fa-grip-vertical"></i>
              </div>

              {{!-- Track Icon --}}
              <div class="track-icon">
                {{#if (eq group 'music')}}
                <i class="fa-solid fa-music"></i>
                {{else if (eq group 'ambience')}}
                <i class="fa-solid fa-cloud"></i>
                {{else}}
                <i class="fa-solid fa-bolt"></i>
                {{/if}}
              </div>

              {{!-- Track Info --}}
              <div class="track-info">
                <div class="title-line">
                  <span class="track-title">{{name}}</span>
                </div>
                <div class="tags-line">
                  <span class="category-badge" data-action="channel-dropdown" data-item-id="{{libraryItemId}}"
                    title="Audio Channel">
                    {{group}} <i class="fa-solid fa-chevron-down"></i>
                  </span>
                  {{#each tags}}
                  <span class="tag">#{{this}}</span>
                  {{/each}}
                </div>
              </div>

              {{!-- Volume Control --}}
              <div class="volume-container">
                <i class="fa-solid fa-volume-up vol-icon"></i>
                <input type="range" class="volume-slider" data-action="volume" min="0" max="100"
                  value="{{volumePercent}}">
                <span class="vol-value">{{volumePercent}}%</span>
              </div>

              {{!-- Playback Buttons --}}
              <div class="playback-buttons">
                {{!-- Play/Pause Toggle --}}
                <button class="btn-icon" data-action="{{#if isPlaying}}pause-queue{{else}}play-queue{{/if}}"
                  title="{{#if isPlaying}}Pause{{else}}Play{{/if}}">
                  <i class="fa-solid {{#if isPlaying}}fa-pause{{else}}fa-play{{/if}}"></i>
                </button>
                {{!-- Stop --}}
                <button class="btn-icon" data-action="stop-queue" title="Stop">
                  <i class="fa-solid fa-stop"></i>
                </button>
                {{!-- Playback Mode --}}
                <button class="btn-icon" data-action="track-mode-dropdown" data-item-id="{{libraryItemId}}"
                  title="Playback Mode: {{playbackMode}}">
                  <i
                    class="fa-solid {{#if (eq playbackMode 'single')}}fa-arrow-right-to-line{{else if (eq playbackMode 'linear')}}fa-arrow-right{{else if (eq playbackMode 'loop')}}fa-repeat{{else if (eq playbackMode 'random')}}fa-shuffle{{else}}fa-arrow-turn-down{{/if}}"></i>
                </button>
              </div>

              {{!-- Delete Button --}}
              <button class="btn-icon btn-delete-inline" data-action="remove-queue" title="Remove from Queue">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>

            {{!-- Row 2: Progress Bar + Timer --}}
            <div class="progress-wrapper">
              <div class="progress-section">
                <input type="range" class="seek-slider" data-action="seek" min="0" max="100" value="{{progress}}"
                  step="0.1">
                <div class="progress-fill {{#if (eq progress 0)}}notransition{{/if}}" style="width: {{progress}}%;">
                </div>
                <div class="progress-hover-time" style="display: none;"></div>
              </div>
              <div class="track-timer">
                {{currentTimeFormatted}} / {{durationFormatted}}
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
      {{/each}}
      {{else}}
      <div class="ase-empty-list-area">
        <div class="ase-empty-state-container">
          <i class="fa-solid fa-list ase-empty-state-icon"></i>
          <p>Queue is empty</p>
          <p class="ase-hint">Add tracks from Favorites or Library</p>
        </div>
      </div>
      {{/if}}
    </div>

    {{!-- Effects Control Panel --}}
    <div class="ase-mixer-effects-panel">
      <div class="ase-effects-toggles">
        {{#each effects}}
        <button class="ase-effect-btn {{#if enabled}}active{{/if}}" data-action="toggle-effect" data-effect-id="{{id}}">
          {{name}}
        </button>
        {{/each}}
      </div>
    </div>
  </main>
</div>