<!-- Workspace (Sidebar + Main) -->
<div class="ase-workspace">

  <aside class="ase-sidebar">
    <!-- Playlists -->
    <div class="ase-sidebar-section">
      <div class="ase-sidebar-header">
        <span class="ase-sidebar-title"><i class="fa-solid fa-list"></i> Playlists</span>
        <button class="ase-add-track-btn ase-btn-compact" data-action="create-playlist">+ Create</button>
      </div>
      <ul class="ase-list-group" data-sortable="playlists">
        {{#each playlists}}
        <li class="ase-list-item {{#if this.selected}}active{{/if}}" data-playlist-id="{{this.id}}"
          data-action="select-playlist" draggable="true">
          <span>{{this.name}} ({{this.trackCount}})</span>
          <div class="ase-icons">
            <span class="ase-play-btn" data-action="play-playlist" data-playlist-id="{{this.id}}" title="Play Playlist">
              <i class="fa-solid fa-play"></i>
            </span>
            <!-- Playlist Mode Selector -->
            <i class="fa-solid ase-mode-icon
                {{#if (eq this.playbackMode 'loop')}}fa-repeat{{else if (eq this.playbackMode 'linear')}}fa-arrow-right{{else if (eq this.playbackMode 'random')}}fa-shuffle{{else}}fa-repeat{{/if}}"
              title="Playback Mode: {{this.playbackMode}}" data-action="playlist-mode-dropdown"
              data-playlist-id="{{this.id}}"></i>
            <span class="ase-queue-btn {{#if this.inQueue}}active{{/if}}" data-action="toggle-playlist-queue"
              data-playlist-id="{{this.id}}" title="Add to Queue">
              <i class="ase-icon-add-queue"></i>
            </span>
            <i class="fa-solid fa-star {{#if this.favorite}}active{{/if}}" data-action="toggle-playlist-favorite"
              data-playlist-id="{{this.id}}" title="Favorite"></i>
          </div>
        </li>
        {{/each}}
      </ul>
    </div>

    <!-- Favorites -->
    <div class="ase-sidebar-section ase-favorites-section">
      <div class="ase-sidebar-header">
        <span class="ase-sidebar-title"><i class="fa-solid fa-star"></i> Favorites</span>
      </div>
      <ul class="ase-list-group">
        {{#each favorites}}
        <li class="ase-list-item ase-favorite-item" data-favorite-id="{{this.id}}" data-favorite-type="{{this.type}}"
          draggable="true">
          <div class="ase-favorite-info">
            {{#if (eq this.type 'playlist')}}
            <i class="fa-solid fa-list ase-type-icon"></i>
            {{else}}
            {{#if (eq this.group 'sfx')}}
            <i class="fa-solid fa-bolt ase-type-icon"></i>
            {{else if (eq this.group 'ambience')}}
            <i class="fa-solid fa-cloud ase-type-icon"></i>
            {{else}}
            <i class="fa-solid fa-music ase-type-icon"></i>
            {{/if}}
            {{/if}}
            <span>{{this.name}}</span>
          </div>
          <div class="ase-icons">
            <span class="ase-queue-btn {{#if this.inQueue}}active{{/if}}" data-action="toggle-favorite-queue"
              data-favorite-id="{{this.id}}" data-favorite-type="{{this.type}}" title="Add to Queue">
              <i class="ase-icon-add-queue"></i>
            </span>
            <i class="fa-solid fa-star active" data-action="remove-from-favorites" data-favorite-id="{{this.id}}"
              data-favorite-type="{{this.type}}" title="Remove from Favorites"></i>
          </div>
        </li>
        {{/each}}
      </ul>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="ase-content-area">

    <!-- Top Filters (Moved from top-level) -->
    <div class="ase-filters-bar">
      <div class="ase-filter-buttons">
        <button class="ase-btn-filter {{#if filters.music}}active{{/if}}" data-action="filter-channel"
          data-channel="music">Music</button>
        <button class="ase-btn-filter {{#if filters.ambience}}active{{/if}}" data-action="filter-channel"
          data-channel="ambience">Ambience</button>
        <button class="ase-btn-filter {{#if filters.sfx}}active{{/if}}" data-action="filter-channel"
          data-channel="sfx">SFX</button>
      </div>

      <!-- Tags inline -->
      <div class="ase-tags-inline">
        {{#each tags}}
        <span class="ase-tag {{#if this.selected}}selected{{/if}}" data-action="toggle-tag"
          data-tag="{{this.value}}">#{{this.name}}</span>
        {{/each}}
        <button class="ase-add-tag-mini" data-action="add-tag"><i class="fa-solid fa-plus"></i></button>
      </div>

      <div class="ase-add-track-btn" data-action="add-track">
        Add Track
      </div>
    </div>

    <!-- Content Controls (Sort & Stats + Search) -->
    <div class="ase-content-controls">
      <!-- All Tracks Button -->
      <button class="ase-btn-text ase-btn-all-tracks" data-action="clear-filters">
        All Tracks ({{stats.totalItems}})
      </button>

      <!-- Search Input (Moved here) -->
      <div class="ase-search-input-wrapper">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" class="ase-search-input" placeholder="Search..." value="{{searchQuery}}">
        <i class="fa-solid fa-xmark ase-search-clear"></i>
      </div>

      <!-- Sorting -->
      <div class="ase-sort-dropdown">
        <span class="ase-text-label-sm">Sorting...</span>
        <select class="ase-sort-select" data-action="sort-change">
          <option value="playable" {{#if (eq sortBy 'playable' )}}selected{{/if}}>Playable</option>
          <option value="date-desc" {{#if (eq sortBy 'date-desc' )}}selected{{/if}}>Date Added (Newest)</option>
          <option value="date-asc" {{#if (eq sortBy 'date-asc' )}}selected{{/if}}>Date Added (Oldest)</option>
          <option value="duration-desc" {{#if (eq sortBy 'duration-desc' )}}selected{{/if}}>Duration (Longest)</option>
          <option value="duration-asc" {{#if (eq sortBy 'duration-asc' )}}selected{{/if}}>Duration (Shortest)</option>
          <option value="name-asc" {{#if (eq sortBy 'name-asc' )}}selected{{/if}}>Name (A-Z)</option>
          <option value="name-desc" {{#if (eq sortBy 'name-desc' )}}selected{{/if}}>Name (Z-A)</option>
        </select>
      </div>
    </div>

    <!-- Maximum Height Track List Container -->
    <div class="ase-track-player-list">
      {{#if items.length}}
      {{#each items}}
      <div class="ase-track-player-item {{#if this.isPlaying}}is-playing{{else if this.isPaused}}is-paused{{/if}}"
        draggable="true" data-item-id="{{this.id}}">
        <!-- Cover Art (Placeholder for now) -->
        <div class="ase-track-image">
          {{#if (eq this.group 'music')}}
          <i class="fa-solid fa-music"></i>
          {{else if (eq this.group 'ambience')}}
          <i class="fa-solid fa-cloud"></i>
          {{else if (eq this.group 'sfx')}}
          <i class="fa-solid fa-bolt"></i>
          {{else}}
          <i class="fa-solid fa-music"></i>
          {{/if}}
        </div>

        <!-- Row 1: Title + Controls -->
        <div class="ase-track-header">
          <div class="ase-track-title-block">
            <span class="ase-track-name">{{this.name}}</span>
            <span class="ase-track-duration">{{this.durationFormatted}}</span>
          </div>

          <div class="ase-track-controls">
            <!-- Play/Pause/Stop -->
            <div class="ase-playback-controls">
              {{#if this.isPlaying}}
              <i class="fa-solid fa-pause" data-action="pause-track" data-item-id="{{this.id}}" title="Pause"></i>
              {{else}}
              <i class="fa-solid fa-play" data-action="play-track" data-item-id="{{this.id}}" title="Play"></i>
              {{/if}}
              <i class="fa-solid fa-stop" data-action="stop-track" data-item-id="{{this.id}}" title="Stop"></i>
            </div>

            <!-- Track Mode Selector -->
            <i class="fa-solid ase-mode-icon
                {{#if (eq this.playbackMode 'single')}}fa-arrow-right-to-line
                {{else if (eq this.playbackMode 'linear')}}fa-arrow-right
                {{else if (eq this.playbackMode 'loop')}}fa-repeat
                {{else if (eq this.playbackMode 'random')}}fa-shuffle
                {{else if (eq this.playbackMode 'inherit')}}fa-arrow-turn-down
                {{else}}fa-arrow-turn-down{{/if}}" title="Playback Mode: {{this.playbackMode}}"
              data-action="track-mode-dropdown" data-item-id="{{this.id}}"></i>

            <!-- Add to Queue -->
            <span class="ase-queue-btn {{#if this.inQueue}}active{{/if}}" data-action="add-to-queue"
              data-item-id="{{this.id}}" title="Add to Queue">
              <i class="ase-icon-add-queue"></i>
            </span>

            <!-- Favorite -->
            <i class="fa-solid fa-star {{#if this.favorite}}active{{/if}}" data-action="toggle-favorite"
              data-item-id="{{this.id}}" title="Favorite"></i>

            <!-- Delete -->
            <i class="fa-solid fa-trash ase-btn-delete" data-action="delete-track" data-item-id="{{this.id}}"
              title="Delete"></i>
          </div>
        </div>

        <!-- Row 2: Channel Dropdown + Tags -->
        <div class="ase-track-row2">
          <!-- Channel Dropdown -->
          <div class="ase-channel-select" data-action="channel-dropdown" data-item-id="{{this.id}}">
            <span>{{this.group}}</span>
            <i class="fa-solid fa-chevron-down"></i>
          </div>

          <!-- Tags -->
          <div class="ase-track-tags ase-mt-0">
            {{#each this.tags}}
            <span class="ase-tag" data-tag="{{this}}" data-item-id="{{../id}}" data-action="toggle-tag">#{{this}}</span>
            {{/each}}
            <i class="fa-solid fa-plus ase-add-tag-btn" data-action="add-tag-to-track" data-item-id="{{this.id}}"></i>
          </div>
        </div>
      </div>
      {{/each}}
      {{else}}
      <div class="ase-empty-list-area">
        <div class="ase-empty-state-container">
          <i class="fa-solid fa-music ase-empty-state-icon"></i>
          <p>No tracks found</p>
        </div>
      </div>
      {{/if}}
    </div>
  </main>
</div>
