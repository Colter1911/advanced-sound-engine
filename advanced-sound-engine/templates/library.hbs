<div class="library-wrapper">
  <!-- Main Content Area (3 columns) -->
  <div class="library-content">
    <!-- Left Sidebar: Playlists (A5) + Favorites (A6) -->
    <div class="library-sidebar">
      <!-- Playlists Section (A5) -->
      <div class="sidebar-section playlists-section">
        <div class="section-header">
          <h3>Playlists</h3>
          <button type="button" class="icon-btn create-playlist-btn" data-action="create-playlist" title="Create Playlist">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <div class="playlists-list scrollable">
          {{#if playlists.length}}
            {{#each playlists}}
              <div class="playlist-item {{#if this.selected}}selected{{/if}}"
                   data-playlist-id="{{this.id}}"
                   data-action="select-playlist">
                <div class="playlist-info">
                  <span class="playlist-name">{{this.name}}</span>
                  <span class="playlist-count">({{this.itemCount}})</span>
                </div>
                <div class="playlist-actions">
                  <button class="icon-btn"
                          data-action="toggle-playlist-favorite"
                          data-playlist-id="{{this.id}}"
                          title="{{#if this.favorite}}Remove from favorites{{else}}Add to favorites{{/if}}">
                    <i class="fas fa-star {{#if this.favorite}}active{{/if}}"></i>
                  </button>
                  <button class="icon-btn"
                          data-action="playlist-menu"
                          data-playlist-id="{{this.id}}"
                          title="More options">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                </div>
              </div>
            {{/each}}
          {{else}}
            <div class="empty-message">
              <p>No playlists yet</p>
            </div>
          {{/if}}
        </div>
      </div>

      <!-- Favorites Section (A6) -->
      <div class="sidebar-section favorites-section">
        <div class="section-header">
          <h3>Favorites</h3>
        </div>
        <div class="favorites-list scrollable">
          {{#if favorites.length}}
            {{#each favorites}}
              <div class="favorite-item"
                   data-favorite-id="{{this.id}}"
                   data-favorite-type="{{this.type}}">
                <div class="favorite-info">
                  {{#if (eq this.type 'playlist')}}
                    <i class="fas fa-list"></i>
                  {{else}}
                    <i class="fas fa-music"></i>
                  {{/if}}
                  <span class="favorite-name">{{this.name}}</span>
                </div>
                <button class="icon-btn"
                        data-action="remove-from-favorites"
                        data-favorite-id="{{this.id}}"
                        data-favorite-type="{{this.type}}"
                        title="Remove from favorites">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            {{/each}}
          {{else}}
            <div class="empty-message">
              <p>No favorites</p>
            </div>
          {{/if}}
        </div>
      </div>
    </div>

    <!-- Main Content: Search, Filters, Tags, Tracks (A2, A3, A4) -->
    <div class="library-main">
      <!-- Search & Filters (A2) -->
      <div class="library-toolbar">
        <div class="search-container">
          <i class="fas fa-search"></i>
          <input type="text"
                 placeholder="Search tracks..."
                 class="library-search"
                 value="{{searchQuery}}"
                 data-action="search" />
          {{#if searchQuery}}
            <button class="icon-btn clear-search-btn" data-action="clear-search" title="Clear search">
              <i class="fas fa-times"></i>
            </button>
          {{/if}}
        </div>

        <div class="filter-group">
          <div class="filter-channels">
            <button class="filter-btn checkbox-btn {{#if channels.music}}active{{/if}}"
                    data-channel="music"
                    data-action="toggle-channel">
              <i class="fas fa-{{#if channels.music}}check-square{{else}}square{{/if}}"></i>
              Music
            </button>
            <button class="filter-btn checkbox-btn {{#if channels.ambience}}active{{/if}}"
                    data-channel="ambience"
                    data-action="toggle-channel">
              <i class="fas fa-{{#if channels.ambience}}check-square{{else}}square{{/if}}"></i>
              Ambience
            </button>
            <button class="filter-btn checkbox-btn {{#if channels.sfx}}active{{/if}}"
                    data-channel="sfx"
                    data-action="toggle-channel">
              <i class="fas fa-{{#if channels.sfx}}check-square{{else}}square{{/if}}"></i>
              SFX
            </button>
          </div>

          {{#if hasActiveFilters}}
            <button class="filter-btn clear-all-btn" data-action="clear-all" title="Clear tags and playlist filters">
              <i class="fas fa-times"></i>
              All
            </button>
          {{/if}}

          <button class="btn-primary add-track-btn" data-action="add-track">
            <i class="fas fa-plus"></i>
            Add Track
          </button>
        </div>
      </div>

      <!-- Tags (A3) -->
      <div class="library-tags">
        <div class="tags-scroll">
          {{#if tags.length}}
            {{#each tags}}
              <button class="tag-chip {{#if this.selected}}selected{{/if}}"
                      data-action="toggle-tag"
                      data-tag="{{this.name}}">
                #{{this.name}}
              </button>
            {{/each}}
          {{/if}}
          <button class="tag-chip add-tag-btn" data-action="add-tag" title="Add new tag">
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </div>

      <!-- Sorting -->
      <div class="library-sort">
        <label>Sorting:</label>
        <select class="sort-select" data-action="change-sort">
          <option value="name-asc" {{#if (eq sortBy 'name-asc')}}selected{{/if}}>Name (A-Z)</option>
          <option value="name-desc" {{#if (eq sortBy 'name-desc')}}selected{{/if}}>Name (Z-A)</option>
          <option value="date-asc" {{#if (eq sortBy 'date-asc')}}selected{{/if}}>Date Added (Oldest)</option>
          <option value="date-desc" {{#if (eq sortBy 'date-desc')}}selected{{/if}}>Date Added (Newest)</option>
          <option value="duration-asc" {{#if (eq sortBy 'duration-asc')}}selected{{/if}}>Duration (Shortest)</option>
          <option value="duration-desc" {{#if (eq sortBy 'duration-desc')}}selected{{/if}}>Duration (Longest)</option>
        </select>
      </div>

      <!-- Tracks List (A4 / B.S.2) -->
      <div class="library-tracks scrollable">
        {{#if items.length}}
          {{#each items}}
            <div class="track-item"
                 data-item-id="{{this.id}}"
                 data-track-group="{{this.group}}"
                 draggable="true">
              <!-- Track Controls -->
              <div class="track-controls">
                <button class="icon-btn play-btn"
                        data-action="play-track"
                        data-item-id="{{this.id}}"
                        title="Play">
                  <i class="fas fa-play"></i>
                </button>
                <button class="icon-btn stop-btn"
                        data-action="stop-track"
                        data-item-id="{{this.id}}"
                        title="Stop">
                  <i class="fas fa-stop"></i>
                </button>
              </div>

              <!-- Track Group Selector -->
              <div class="track-group">
                <select class="group-select" data-action="change-group" data-item-id="{{this.id}}">
                  <option value="music" {{#if (eq this.group 'music')}}selected{{/if}}>Music</option>
                  <option value="ambience" {{#if (eq this.group 'ambience')}}selected{{/if}}>Ambience</option>
                  <option value="sfx" {{#if (eq this.group 'sfx')}}selected{{/if}}>SFX</option>
                </select>
              </div>

              <!-- Track Info -->
              <div class="track-info">
                <div class="track-name">{{this.name}}</div>
                <div class="track-tags">
                  {{#if this.tags.length}}
                    {{#each this.tags}}
                      <span class="tag-chip mini">{{this}}</span>
                    {{/each}}
                  {{/if}}
                </div>
              </div>

              <!-- Track Duration -->
              <div class="track-duration">
                {{#if this.duration}}
                  {{formatDuration this.duration}}
                {{else}}
                  --:--
                {{/if}}
              </div>

              <!-- Track Actions -->
              <div class="track-actions always-visible">
                <button class="icon-btn tags-btn"
                        data-action="manage-tags"
                        data-item-id="{{this.id}}"
                        title="Manage tags">
                  <i class="fas fa-tags"></i>
                </button>
                <button class="icon-btn favorite-btn {{#if this.favorite}}active{{/if}}"
                        data-action="toggle-favorite"
                        data-item-id="{{this.id}}"
                        title="{{#if this.favorite}}Remove from favorites{{else}}Add to favorites{{/if}}">
                  <i class="fas fa-star"></i>
                </button>

                <button class="icon-btn add-to-playlist-btn"
                        data-action="add-to-playlist"
                        data-item-id="{{this.id}}"
                        title="Add to playlist">
                  <i class="fas fa-list-ul"></i>
                </button>

                <button class="icon-btn menu-btn"
                        data-action="track-menu"
                        data-item-id="{{this.id}}"
                        title="More options">
                  <i class="fas fa-ellipsis-v"></i>
                </button>
              </div>
            </div>
          {{/each}}
        {{else}}
          <div class="empty-state">
            <i class="fas fa-music"></i>
            <p>No tracks in library</p>
            <p class="hint">Click "Add Track" to get started</p>
          </div>
        {{/if}}
      </div>
    </div>
  </div>

  <!-- Bottom Mixer Panel -->
  <div class="library-mixer-panel">
    <div class="mixer-controls">
      <!-- Global Playback Controls -->
      <div class="global-controls">
        <button class="control-btn play-all-btn" title="Play">
          <i class="fas fa-play"></i>
        </button>
        <button class="control-btn pause-all-btn" title="Pause">
          <i class="fas fa-pause"></i>
        </button>
        <button class="control-btn stop-all-btn" title="Stop">
          <i class="fas fa-square"></i>
        </button>
      </div>

      <!-- Channel Sliders -->
      <div class="channel-sliders">
        <!-- SFX Channel -->
        <div class="channel-slider">
          <div class="channel-header">
            <i class="fas fa-volume-up"></i>
            <span class="channel-name">SFX</span>
          </div>
          <input type="range" class="slider" min="0" max="100" value="26" />
          <span class="channel-value">26%</span>
        </div>

        <!-- AMBIENCE Channel -->
        <div class="channel-slider">
          <div class="channel-header">
            <i class="fas fa-wind"></i>
            <span class="channel-name">AMBIENCE</span>
          </div>
          <input type="range" class="slider" min="0" max="100" value="56" />
          <span class="channel-value">56%</span>
        </div>

        <!-- MUSIC Channel -->
        <div class="channel-slider">
          <div class="channel-header">
            <i class="fas fa-music"></i>
            <span class="channel-name">MUSIC</span>
          </div>
          <input type="range" class="slider" min="0" max="100" value="26" />
          <span class="channel-value">26%</span>
        </div>
      </div>

      <!-- Master Volume -->
      <div class="master-volume">
        <div class="master-header">
          <i class="fas fa-sliders-h"></i>
          <span class="master-label">MASTER</span>
        </div>
        <input type="range" class="slider master-slider" min="0" max="100" value="56" />
        <span class="master-value">56%</span>
      </div>

      <!-- Sync Toggle -->
      <div class="sync-toggle">
        <label class="toggle-label">
          <input type="checkbox" class="sync-checkbox" checked />
          <span class="toggle-switch"></span>
          <span class="toggle-text">SYNC ON</span>
        </label>
      </div>

      <!-- Additional Controls -->
      <div class="additional-controls">
        <button class="control-btn" title="Settings">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </div>
  </div>
</div>
