<!-- Search Toolbar -->
<div class="ase-search-toolbar">
  <div class="ase-search-input-wrapper">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="text" class="ase-search-input" placeholder="Search..." value="{{searchQuery}}">
    <i class="fa-solid fa-xmark ase-search-clear"></i>
  </div>

  <div class="ase-filter-buttons">
    <button class="ase-btn-filter {{#if filters.music}}active{{/if}}" data-action="filter-channel"
      data-channel="music">Music</button>
    <button class="ase-btn-filter {{#if filters.ambience}}active{{/if}}" data-action="filter-channel"
      data-channel="ambience">Ambience</button>
    <button class="ase-btn-filter {{#if filters.sfx}}active{{/if}}" data-action="filter-channel"
      data-channel="sfx">SFX</button>
  </div>

  <!-- Tags inline -->
  <div class="ase-tags-inline">
    {{#each tags}}
    <span class="ase-tag {{#if this.selected}}selected{{/if}}" data-action="toggle-tag"
      data-tag="{{this.value}}">#{{this.name}}</span>
    {{/each}}
    <button class="ase-add-tag-mini" data-action="add-tag"><i class="fa-solid fa-plus"></i></button>
  </div>

  <div class="ase-add-track-btn" data-action="add-track">
    Add Track
  </div>
</div>

<!-- Workspace (Sidebar + Main) -->
<div class="ase-workspace">

  <aside class="ase-sidebar">
    <!-- Playlists -->
    <div class="ase-sidebar-section">
      <div class="ase-sidebar-header">
        <span class="ase-sidebar-title"><i class="fa-solid fa-list"></i> Playlists</span>
        <button class="ase-add-track-btn ase-btn-compact" data-action="create-playlist">+ Create</button>
      </div>
      <ul class="ase-list-group" data-sortable="playlists">
        {{#each playlists}}
        <li class="ase-list-item {{#if this.selected}}active{{/if}}" data-playlist-id="{{this.id}}"
          data-action="select-playlist" draggable="true">
          <span>{{this.name}} ({{this.trackCount}})</span>
          <div class="ase-icons">
            <i class="ase-icon-add-queue {{#if this.inQueue}}active{{/if}}" data-action="toggle-playlist-queue"
              data-playlist-id="{{this.id}}" title="Add to Queue"></i>
            <i class="fa-solid fa-star {{#if this.favorite}}active{{/if}}"
              style="{{#if this.favorite}}color: var(--accent-cyan);{{/if}}" data-action="toggle-playlist-favorite"
              data-playlist-id="{{this.id}}" title="Favorite"></i>
          </div>
        </li>
        {{/each}}
      </ul>
    </div>

    <!-- Favorites -->
    <div class="ase-sidebar-section ase-favorites-section">
      <div class="ase-sidebar-header">
        <span><i class="fa-solid fa-star"></i> Favorites</span>
      </div>
      <ul class="ase-list-group">
        {{#each favorites}}
        <li class="ase-list-item" data-favorite-id="{{this.id}}">
          <span>{{this.name}}</span>
          <div class="ase-icons">
            {{#if (eq this.type 'playlist')}}
            <i class="fa-solid fa-list"></i>
            {{else}}
            <i class="fa-solid fa-music"></i>
            {{/if}}
            <i class="fa-solid fa-star" style="color: var(--accent-cyan);" data-action="remove-from-favorites"></i>
          </div>
        </li>
        {{/each}}
      </ul>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="ase-content-area">
    <div class="ase-content-controls">
      <button class="ase-btn-text" data-action="clear-filters">All Tracks ({{stats.totalItems}})</button>
      <!-- Sorting placeholder, logic can be added later -->
      <button class="ase-btn-text">Sorting... <i class="fa-solid fa-chevron-down"></i></button>
    </div>

    <!-- Tracks List -->
    <div class="ase-track-player-list" style="flex: 1; overflow-y: auto;">
      {{#if items.length}}
      {{#each items}}
      <div class="ase-track-player-item">
        <div class="ase-track-info">
          <div class="ase-track-title">
            {{this.name}} <span class="time">{{#if this.duration}}{{this.duration}}{{else}}--:--{{/if}}</span>
          </div>
          <div class="ase-track-tags">
            <span class="ase-btn-filter small" style="border:none; background:#222; color: #888;">{{this.group}}</span>
            {{#each this.tags}}
            <span class="ase-tag">#{{this}}</span>
            {{/each}}
            <span class="ase-add-tag-mini" data-action="add-tag-to-track" data-item-id="{{this.id}}"><i
                class="fa-solid fa-plus"></i></span>
          </div>
        </div>
        <div class="ase-track-actions">
          <i class="fa-solid fa-play" data-action="play-track" data-item-id="{{this.id}}"></i>
          <i class="fa-solid fa-pause" data-action="pause-track" data-item-id="{{this.id}}"></i>
          <i class="fa-solid fa-stop" data-action="stop-track" data-item-id="{{this.id}}"></i>
          <i class="fa-solid fa-star {{#if this.favorite}}active{{/if}}"
            style="{{#if this.favorite}}color: var(--accent-cyan);{{/if}}" data-action="toggle-favorite"
            data-item-id="{{this.id}}"></i>

          <div class="ase-secondary-actions">
            <!-- <i class="fa-solid fa-rotate-right" title="Loop"></i> -->
            <i class="fa-solid fa-trash" data-action="delete-track" data-item-id="{{this.id}}"></i>
          </div>
        </div>
      </div>
      {{/each}}
      {{else}}
      <div class="ase-empty-list-area">
        <center style="opacity: 0.5;">
          <i class="fas fa-music" style="font-size: 48px; margin-bottom: 20px;"></i>
          <p>No tracks found</p>
        </center>
      </div>
      {{/if}}
    </div>
  </main>
</div>